"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * Object representation of the chunk section of a MIDI file.
 * @param {object} fields - {type: number, data: array, size: array}
 * @return {Chunk}
 */
var Chunk = function Chunk(fields) {
	_classCallCheck(this, Chunk);

	this.type = fields.type;
	this.data = fields.data;
	this.size = [0, 0, 0, fields.data.length];
};

exports.Chunk = Chunk;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jaHVuay5qcyJdLCJuYW1lcyI6WyJDaHVuayIsImZpZWxkcyIsInR5cGUiLCJkYXRhIiwic2l6ZSIsImxlbmd0aCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7Ozs7SUFLTUEsSyxHQUNMLGVBQVlDLE1BQVosRUFBb0I7QUFBQTs7QUFDbkIsTUFBS0MsSUFBTCxHQUFZRCxPQUFPQyxJQUFuQjtBQUNBLE1BQUtDLElBQUwsR0FBWUYsT0FBT0UsSUFBbkI7QUFDQSxNQUFLQyxJQUFMLEdBQVksQ0FBQyxDQUFELEVBQUksQ0FBSixFQUFPLENBQVAsRUFBVUgsT0FBT0UsSUFBUCxDQUFZRSxNQUF0QixDQUFaO0FBQ0EsQzs7UUFHTUwsSyxHQUFBQSxLIiwiZmlsZSI6ImNodW5rLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhlIGNodW5rIHNlY3Rpb24gb2YgYSBNSURJIGZpbGUuXG4gKiBAcGFyYW0ge29iamVjdH0gZmllbGRzIC0ge3R5cGU6IG51bWJlciwgZGF0YTogYXJyYXksIHNpemU6IGFycmF5fVxuICogQHJldHVybiB7Q2h1bmt9XG4gKi9cbmNsYXNzIENodW5rIHtcblx0Y29uc3RydWN0b3IoZmllbGRzKSB7XG5cdFx0dGhpcy50eXBlID0gZmllbGRzLnR5cGU7XG5cdFx0dGhpcy5kYXRhID0gZmllbGRzLmRhdGE7XG5cdFx0dGhpcy5zaXplID0gWzAsIDAsIDAsIGZpZWxkcy5kYXRhLmxlbmd0aF07XG5cdH1cbn1cblxuZXhwb3J0IHtDaHVua307XG4iXX0=
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
/**
 * MIDI file format constants, including note -> MIDI number translation.
 * @return {Constants}
 */

var Constants = {
	VERSION: '1.4.8',
	HEADER_CHUNK_TYPE: [0x4d, 0x54, 0x68, 0x64], // Mthd
	HEADER_CHUNK_LENGTH: [0x00, 0x00, 0x00, 0x06], // Header size for SMF
	HEADER_CHUNK_FORMAT0: [0x00, 0x00], // Midi Type 0 id
	HEADER_CHUNK_FORMAT1: [0x00, 0x01], // Midi Type 1 id
	HEADER_CHUNK_DIVISION: [0x00, 0x80], // Defaults to 128 ticks per beat
	TRACK_CHUNK_TYPE: [0x4d, 0x54, 0x72, 0x6b], // MTrk,
	META_EVENT_ID: 0xFF,
	META_TEXT_ID: 0x01,
	META_COPYRIGHT_ID: 0x02,
	META_TRACK_NAME_ID: 0x03,
	META_INSTRUMENT_NAME_ID: 0x04,
	META_LYRIC_ID: 0x05,
	META_MARKER_ID: 0x06,
	META_CUE_POINT: 0x07,
	META_TEMPO_ID: 0x51,
	META_SMTPE_OFFSET: 0x54,
	META_TIME_SIGNATURE_ID: 0x58,
	META_KEY_SIGNATURE_ID: 0x59,
	META_END_OF_TRACK_ID: [0x2F, 0x00],
	PROGRAM_CHANGE_STATUS: 0xC0 // includes channel number (0)
};

exports.Constants = Constants;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25zdGFudHMuanMiXSwibmFtZXMiOlsiQ29uc3RhbnRzIiwiVkVSU0lPTiIsIkhFQURFUl9DSFVOS19UWVBFIiwiSEVBREVSX0NIVU5LX0xFTkdUSCIsIkhFQURFUl9DSFVOS19GT1JNQVQwIiwiSEVBREVSX0NIVU5LX0ZPUk1BVDEiLCJIRUFERVJfQ0hVTktfRElWSVNJT04iLCJUUkFDS19DSFVOS19UWVBFIiwiTUVUQV9FVkVOVF9JRCIsIk1FVEFfVEVYVF9JRCIsIk1FVEFfQ09QWVJJR0hUX0lEIiwiTUVUQV9UUkFDS19OQU1FX0lEIiwiTUVUQV9JTlNUUlVNRU5UX05BTUVfSUQiLCJNRVRBX0xZUklDX0lEIiwiTUVUQV9NQVJLRVJfSUQiLCJNRVRBX0NVRV9QT0lOVCIsIk1FVEFfVEVNUE9fSUQiLCJNRVRBX1NNVFBFX09GRlNFVCIsIk1FVEFfVElNRV9TSUdOQVRVUkVfSUQiLCJNRVRBX0tFWV9TSUdOQVRVUkVfSUQiLCJNRVRBX0VORF9PRl9UUkFDS19JRCIsIlBST0dSQU1fQ0hBTkdFX1NUQVRVUyJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7QUFLQSxJQUFJQSxZQUFZO0FBQ2ZDLFVBQWMsT0FEQztBQUVmQyxvQkFBdUIsQ0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhLElBQWIsRUFBbUIsSUFBbkIsQ0FGUixFQUVrQztBQUNqREMsc0JBQXdCLENBQUMsSUFBRCxFQUFPLElBQVAsRUFBYSxJQUFiLEVBQW1CLElBQW5CLENBSFQsRUFHbUM7QUFDbERDLHVCQUEwQixDQUFDLElBQUQsRUFBTyxJQUFQLENBSlgsRUFJeUI7QUFDeENDLHVCQUEwQixDQUFDLElBQUQsRUFBTyxJQUFQLENBTFgsRUFLeUI7QUFDeENDLHdCQUEwQixDQUFDLElBQUQsRUFBTyxJQUFQLENBTlgsRUFNeUI7QUFDeENDLG1CQUFvQixDQUFDLElBQUQsRUFBTyxJQUFQLEVBQWEsSUFBYixFQUFtQixJQUFuQixDQVBMLEVBTytCO0FBQzlDQyxnQkFBa0IsSUFSSDtBQVNmQyxlQUFpQixJQVRGO0FBVWZDLG9CQUFxQixJQVZOO0FBV2ZDLHFCQUFzQixJQVhQO0FBWWZDLDBCQUEwQixJQVpYO0FBYWZDLGdCQUFrQixJQWJIO0FBY2ZDLGlCQUFtQixJQWRKO0FBZWZDLGlCQUFtQixJQWZKO0FBZ0JmQyxnQkFBa0IsSUFoQkg7QUFpQmZDLG9CQUFxQixJQWpCTjtBQWtCZkMseUJBQXlCLElBbEJWO0FBbUJmQyx3QkFBd0IsSUFuQlQ7QUFvQmZDLHVCQUF1QixDQUFDLElBQUQsRUFBTyxJQUFQLENBcEJSO0FBcUJmQyx3QkFBd0IsSUFyQlQsQ0FxQmU7QUFyQmYsQ0FBaEI7O1FBd0JRckIsUyxHQUFBQSxTIiwiZmlsZSI6ImNvbnN0YW50cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTUlESSBmaWxlIGZvcm1hdCBjb25zdGFudHMsIGluY2x1ZGluZyBub3RlIC0+IE1JREkgbnVtYmVyIHRyYW5zbGF0aW9uLlxuICogQHJldHVybiB7Q29uc3RhbnRzfVxuICovXG5cbnZhciBDb25zdGFudHMgPSB7XG5cdFZFUlNJT05cdFx0XHRcdFx0OiAnMS40LjgnLFxuXHRIRUFERVJfQ0hVTktfVFlQRSAgXHRcdDogWzB4NGQsIDB4NTQsIDB4NjgsIDB4NjRdLCAvLyBNdGhkXG5cdEhFQURFUl9DSFVOS19MRU5HVEggIFx0OiBbMHgwMCwgMHgwMCwgMHgwMCwgMHgwNl0sIC8vIEhlYWRlciBzaXplIGZvciBTTUZcblx0SEVBREVSX0NIVU5LX0ZPUk1BVDAgICAgOiBbMHgwMCwgMHgwMF0sIC8vIE1pZGkgVHlwZSAwIGlkXG5cdEhFQURFUl9DSFVOS19GT1JNQVQxICAgIDogWzB4MDAsIDB4MDFdLCAvLyBNaWRpIFR5cGUgMSBpZFxuXHRIRUFERVJfQ0hVTktfRElWSVNJT04gICA6IFsweDAwLCAweDgwXSwgLy8gRGVmYXVsdHMgdG8gMTI4IHRpY2tzIHBlciBiZWF0XG5cdFRSQUNLX0NIVU5LX1RZUEVcdFx0OiBbMHg0ZCwgMHg1NCwgMHg3MiwgMHg2Yl0sIC8vIE1UcmssXG5cdE1FVEFfRVZFTlRfSURcdFx0XHQ6IDB4RkYsXG5cdE1FVEFfVEVYVF9JRFx0XHRcdDogMHgwMSxcblx0TUVUQV9DT1BZUklHSFRfSURcdFx0OiAweDAyLFxuXHRNRVRBX1RSQUNLX05BTUVfSURcdFx0OiAweDAzLFxuXHRNRVRBX0lOU1RSVU1FTlRfTkFNRV9JRCA6IDB4MDQsXG5cdE1FVEFfTFlSSUNfSURcdFx0XHQ6IDB4MDUsXG5cdE1FVEFfTUFSS0VSX0lEXHRcdFx0OiAweDA2LFxuXHRNRVRBX0NVRV9QT0lOVFx0XHRcdDogMHgwNyxcblx0TUVUQV9URU1QT19JRFx0XHRcdDogMHg1MSxcblx0TUVUQV9TTVRQRV9PRkZTRVRcdFx0OiAweDU0LFxuXHRNRVRBX1RJTUVfU0lHTkFUVVJFX0lEXHQ6IDB4NTgsXG5cdE1FVEFfS0VZX1NJR05BVFVSRV9JRFx0OiAweDU5LFxuXHRNRVRBX0VORF9PRl9UUkFDS19JRFx0OiBbMHgyRiwgMHgwMF0sXG5cdFBST0dSQU1fQ0hBTkdFX1NUQVRVU1x0OiAweEMwLCAvLyBpbmNsdWRlcyBjaGFubmVsIG51bWJlciAoMClcbn07XG5cbmV4cG9ydCB7Q29uc3RhbnRzfTtcbiJdfQ==
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * Object representation of a meta event.
 * @param {object} fields - type, data
 * @return {MetaEvent}
 */
var MetaEvent = function MetaEvent(fields) {
	_classCallCheck(this, MetaEvent);

	this.type = 'meta';
	this.data = Utils.numberToVariableLength(0x00); // Start with zero time delta
	this.data = this.data.concat(Constants.META_EVENT_ID, fields.data);
};

exports.MetaEvent = MetaEvent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tZXRhLWV2ZW50LmpzIl0sIm5hbWVzIjpbIk1ldGFFdmVudCIsImZpZWxkcyIsInR5cGUiLCJkYXRhIiwiVXRpbHMiLCJudW1iZXJUb1ZhcmlhYmxlTGVuZ3RoIiwiY29uY2F0IiwiQ29uc3RhbnRzIiwiTUVUQV9FVkVOVF9JRCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7Ozs7SUFLTUEsUyxHQUNMLG1CQUFZQyxNQUFaLEVBQW9CO0FBQUE7O0FBQ25CLE1BQUtDLElBQUwsR0FBWSxNQUFaO0FBQ0EsTUFBS0MsSUFBTCxHQUFZQyxNQUFNQyxzQkFBTixDQUE2QixJQUE3QixDQUFaLENBRm1CLENBRTRCO0FBQy9DLE1BQUtGLElBQUwsR0FBWSxLQUFLQSxJQUFMLENBQVVHLE1BQVYsQ0FBaUJDLFVBQVVDLGFBQTNCLEVBQTBDUCxPQUFPRSxJQUFqRCxDQUFaO0FBQ0EsQzs7UUFHTUgsUyxHQUFBQSxTIiwiZmlsZSI6Im1ldGEtZXZlbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE9iamVjdCByZXByZXNlbnRhdGlvbiBvZiBhIG1ldGEgZXZlbnQuXG4gKiBAcGFyYW0ge29iamVjdH0gZmllbGRzIC0gdHlwZSwgZGF0YVxuICogQHJldHVybiB7TWV0YUV2ZW50fVxuICovXG5jbGFzcyBNZXRhRXZlbnQge1xuXHRjb25zdHJ1Y3RvcihmaWVsZHMpIHtcblx0XHR0aGlzLnR5cGUgPSAnbWV0YSc7XG5cdFx0dGhpcy5kYXRhID0gVXRpbHMubnVtYmVyVG9WYXJpYWJsZUxlbmd0aCgweDAwKTsvLyBTdGFydCB3aXRoIHplcm8gdGltZSBkZWx0YVxuXHRcdHRoaXMuZGF0YSA9IHRoaXMuZGF0YS5jb25jYXQoQ29uc3RhbnRzLk1FVEFfRVZFTlRfSUQsIGZpZWxkcy5kYXRhKTtcblx0fVxufVxuXG5leHBvcnQge01ldGFFdmVudH07XG4iXX0=
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * Wrapper for noteOnEvent/noteOffEvent objects that builds both events.
 * @param {object} fields - {pitch: '[C4]', duration: '4', wait: '4', velocity: 1-100}
 * @return {NoteEvent}
 */
var NoteEvent = function () {
	function NoteEvent(fields) {
		_classCallCheck(this, NoteEvent);

		this.type = 'note';
		this.pitch = fields.pitch;
		this.wait = fields.wait || 0;
		this.duration = fields.duration;
		this.sequential = fields.sequential || false;
		this.velocity = fields.velocity || 50;
		this.channel = fields.channel || 1;
		this.repeat = fields.repeat || 1;
		this.velocity = this.convertVelocity(this.velocity);
		this.buildData();
	}

	/**
  * Builds int array for this event.
  * @return {NoteEvent}
  */


	_createClass(NoteEvent, [{
		key: 'buildData',
		value: function buildData() {
			this.data = [];

			var tickDuration = this.getTickDuration(this.duration, 'note');
			var restDuration = this.getTickDuration(this.wait, 'rest');

			// fields.pitch could be an array of pitches.
			// If so create note events for each and apply the same duration.
			var noteOn, noteOff;
			if (Array.isArray(this.pitch)) {
				// By default this is a chord if it's an array of notes that requires one NoteOnEvent.
				// If this.sequential === true then it's a sequential string of notes that requires separate NoteOnEvents.
				if (!this.sequential) {
					// Handle repeat
					for (var j = 0; j < this.repeat; j++) {
						// Note on
						this.pitch.forEach(function (p, i) {
							if (i == 0) {
								noteOn = new NoteOnEvent({ data: Utils.numberToVariableLength(restDuration).concat(this.getNoteOnStatus(), Utils.getPitch(p), this.velocity) });
							} else {
								// Running status (can ommit the note on status)
								noteOn = new NoteOnEvent({ data: [0, Utils.getPitch(p), this.velocity] });
							}

							this.data = this.data.concat(noteOn.data);
						}, this);

						// Note off
						this.pitch.forEach(function (p, i) {
							if (i == 0) {
								noteOff = new NoteOffEvent({ data: Utils.numberToVariableLength(tickDuration).concat(this.getNoteOffStatus(), Utils.getPitch(p), this.velocity) });
							} else {
								// Running status (can ommit the note off status)
								noteOff = new NoteOffEvent({ data: [0, Utils.getPitch(p), this.velocity] });
							}

							this.data = this.data.concat(noteOff.data);
						}, this);
					}
				} else {
					// Handle repeat
					for (var j = 0; j < this.repeat; j++) {
						this.pitch.forEach(function (p, i) {
							// restDuration only applies to first note
							if (i > 0) {
								restDuration = 0;
							}

							// If duration is 8th triplets we need to make sure that the total ticks == quarter note.
							// So, the last one will need to be the remainder
							if (this.duration === '8t' && i == this.pitch.length - 1) {
								var quarterTicks = Utils.numberFromBytes(Constants.HEADER_CHUNK_DIVISION);
								tickDuration = quarterTicks - tickDuration * 2;
							}

							noteOn = new NoteOnEvent({ data: Utils.numberToVariableLength(restDuration).concat([this.getNoteOnStatus(), Utils.getPitch(p), this.velocity]) });
							noteOff = new NoteOffEvent({ data: Utils.numberToVariableLength(tickDuration).concat([this.getNoteOffStatus(), Utils.getPitch(p), this.velocity]) });

							this.data = this.data.concat(noteOn.data, noteOff.data);
						}, this);
					}
				}

				return this;
			}

			throw 'pitch must be an array.';
		}
	}, {
		key: 'convertVelocity',


		/**
   * Converts velocity to value 0-127
   * @param {number} velocity - Velocity value 1-100
   * @return {number}
   */
		value: function convertVelocity(velocity) {
			// Max passed value limited to 100
			velocity = velocity > 100 ? 100 : velocity;
			return Math.round(velocity / 100 * 127);
		}
	}, {
		key: 'getTickDuration',


		/**
   * Gets the total number of ticks based on passed duration.
   * Note: type=='note' defaults to quarter note, type==='rest' defaults to 0
   * @param {(string|array)} duration
   * @param {string} type ['note', 'rest']
   * @return {number}
   */
		value: function getTickDuration(duration, type) {
			if (Array.isArray(duration)) {
				// Recursively execute this method for each item in the array and return the sum of tick durations.
				return duration.map(function (value) {
					return this.getTickDuration(value, type);
				}, this).reduce(function (a, b) {
					return a + b;
				}, 0);
			}

			duration = duration.toString();

			if (duration.toLowerCase().charAt(0) === 't') {
				// If duration starts with 't' then the number that follows is an explicit tick count
				return parseInt(duration.substring(1));
			}

			// Need to apply duration here.  Quarter note == Constants.HEADER_CHUNK_DIVISION
			// Rounding only applies to triplets, which the remainder is handled below
			var quarterTicks = Utils.numberFromBytes(Constants.HEADER_CHUNK_DIVISION);
			return Math.round(quarterTicks * this.getDurationMultiplier(duration, type));
		}

		/**
   * Gets what to multiple ticks/quarter note by to get the specified duration.
   * Note: type=='note' defaults to quarter note, type==='rest' defaults to 0
   * @param {string} duration
   * @param {string} type ['note','rest']
   * @return {number}
   */

	}, {
		key: 'getDurationMultiplier',
		value: function getDurationMultiplier(duration, type) {
			// Need to apply duration here.  Quarter note == Constants.HEADER_CHUNK_DIVISION
			switch (duration) {
				case '0':
					return 0;
				case '1':
					return 4;
				case '2':
					return 2;
				case 'd2':
					return 3;
				case '4':
					return 1;
				case 'd4':
					return 1.5;
				case '8':
					return 0.5;
				case '8t':
					// For 8th triplets, let's divide a quarter by 3, round to the nearest int, and substract the remainder to the last one.
					return 0.33;
				case 'd8':
					return 0.75;
				case '16':
					return 0.25;
				case '32':
					return 0.125;
				case '64':
					return 0.0625;
				default:
				// Notes default to a quarter, rests default to 0
				//return type === 'note' ? 1 : 0;
			}

			throw duration + ' is not a valid duration.';
		}
	}, {
		key: 'getNoteOnStatus',


		/**
   * Gets the note on status code based on the selected channel. 0x9{0-F}
   * Note on at channel 0 is 0x90 (144)
   * 0 = Ch 1
   * @return {number}
   */
		value: function getNoteOnStatus() {
			return 144 + this.channel - 1;
		}

		/**
   * Gets the note off status code based on the selected channel. 0x8{0-F}
   * Note off at channel 0 is 0x80 (128)
   * 0 = Ch 1
   * @return {number}
   */

	}, {
		key: 'getNoteOffStatus',
		value: function getNoteOffStatus() {
			return 128 + this.channel - 1;
		}
	}]);

	return NoteEvent;
}();

exports.NoteEvent = NoteEvent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9ub3RlLWV2ZW50LmpzIl0sIm5hbWVzIjpbIk5vdGVFdmVudCIsImZpZWxkcyIsInR5cGUiLCJwaXRjaCIsIndhaXQiLCJkdXJhdGlvbiIsInNlcXVlbnRpYWwiLCJ2ZWxvY2l0eSIsImNoYW5uZWwiLCJyZXBlYXQiLCJjb252ZXJ0VmVsb2NpdHkiLCJidWlsZERhdGEiLCJkYXRhIiwidGlja0R1cmF0aW9uIiwiZ2V0VGlja0R1cmF0aW9uIiwicmVzdER1cmF0aW9uIiwibm90ZU9uIiwibm90ZU9mZiIsIkFycmF5IiwiaXNBcnJheSIsImoiLCJmb3JFYWNoIiwicCIsImkiLCJOb3RlT25FdmVudCIsIlV0aWxzIiwibnVtYmVyVG9WYXJpYWJsZUxlbmd0aCIsImNvbmNhdCIsImdldE5vdGVPblN0YXR1cyIsImdldFBpdGNoIiwiTm90ZU9mZkV2ZW50IiwiZ2V0Tm90ZU9mZlN0YXR1cyIsImxlbmd0aCIsInF1YXJ0ZXJUaWNrcyIsIm51bWJlckZyb21CeXRlcyIsIkNvbnN0YW50cyIsIkhFQURFUl9DSFVOS19ESVZJU0lPTiIsIk1hdGgiLCJyb3VuZCIsIm1hcCIsInZhbHVlIiwicmVkdWNlIiwiYSIsImIiLCJ0b1N0cmluZyIsInRvTG93ZXJDYXNlIiwiY2hhckF0IiwicGFyc2VJbnQiLCJzdWJzdHJpbmciLCJnZXREdXJhdGlvbk11bHRpcGxpZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTs7Ozs7SUFLTUEsUztBQUNMLG9CQUFZQyxNQUFaLEVBQW9CO0FBQUE7O0FBQ25CLE9BQUtDLElBQUwsR0FBYyxNQUFkO0FBQ0EsT0FBS0MsS0FBTCxHQUFlRixPQUFPRSxLQUF0QjtBQUNBLE9BQUtDLElBQUwsR0FBY0gsT0FBT0csSUFBUCxJQUFlLENBQTdCO0FBQ0EsT0FBS0MsUUFBTCxHQUFpQkosT0FBT0ksUUFBeEI7QUFDQSxPQUFLQyxVQUFMLEdBQWtCTCxPQUFPSyxVQUFQLElBQXFCLEtBQXZDO0FBQ0EsT0FBS0MsUUFBTCxHQUFpQk4s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UDtBQUNELFNBQUssSUFBTDtBQUNDLFlBQU8sSUFBUDtBQUNELFNBQUssSUFBTDtBQUNDLFlBQU8sS0FBUDtBQUNELFNBQUssSUFBTDtBQUNDLFlBQU8sTUFBUDtBQUNEO0FBQ0M7QUFDQTtBQTVCRjs7QUErQkEsU0FBTUEsV0FBVywyQkFBakI7QUFDQTs7Ozs7QUFFRDs7Ozs7O29DQU1rQjtBQUFDLFVBQU8sTUFBTSxLQUFLRyxPQUFYLEdBQXFCLENBQTVCO0FBQThCOztBQUVqRDs7Ozs7Ozs7O3FDQU1tQjtBQUFDLFVBQU8sTUFBTSxLQUFLQSxPQUFYLEdBQXFCLENBQTVCO0FBQThCOzs7Ozs7UUFHM0NSLFMsR0FBQUEsUyIsImZpbGUiOiJub3RlLWV2ZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBXcmFwcGVyIGZvciBub3RlT25FdmVudC9ub3RlT2ZmRXZlbnQgb2JqZWN0cyB0aGF0IGJ1aWxkcyBib3RoIGV2ZW50cy5cbiAqIEBwYXJhbSB7b2JqZWN0fSBmaWVsZHMgLSB7cGl0Y2g6ICdbQzRdJywgZHVyYXRpb246ICc0Jywgd2FpdDogJzQnLCB2ZWxvY2l0eTogMS0xMDB9XG4gKiBAcmV0dXJuIHtOb3RlRXZlbnR9XG4gKi9cbmNsYXNzIE5vdGVFdmVudCB7XG5cdGNvbnN0cnVjdG9yKGZpZWxkcykge1xuXHRcdHRoaXMudHlwZSBcdFx0PSAnbm90ZSc7XG5cdFx0dGhpcy5waXRjaCBcdFx0PSBmaWVsZHMucGl0Y2g7XG5cdFx0dGhpcy53YWl0IFx0XHQ9IGZpZWxkcy53YWl0IHx8IDA7XG5cdFx0dGhpcy5kdXJhdGlvbiBcdD0gZmllbGRzLmR1cmF0aW9uO1xuXHRcdHRoaXMuc2VxdWVudGlhbCA9IGZpZWxkcy5zZXF1ZW50aWFsIHx8IGZhbHNlO1xuXHRcdHRoaXMudmVsb2NpdHkgXHQ9IGZpZWxkcy52ZWxvY2l0eSB8fCA1MDtcblx0XHR0aGlzLmNoYW5uZWwgXHQ9IGZpZWxkcy5jaGFubmVsIHx8IDE7XG5cdFx0dGhpcy5yZXBlYXQgXHQ9IGZpZWxkcy5yZXBlYXQgfHwgMTtcblx0XHR0aGlzLnZlbG9jaXR5IFx0PSB0aGlzLmNvbnZlcnRWZWxvY2l0eSh0aGlzLnZlbG9jaXR5KTtcblx0XHR0aGlzLmJ1aWxkRGF0YSgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEJ1aWxkcyBpbnQgYXJyYXkgZm9yIHRoaXMgZXZlbnQuXG5cdCAqIEByZXR1cm4ge05vdGVFdmVudH1cblx0ICovXG5cdGJ1aWxkRGF0YSgpIHtcblx0XHR0aGlzLmRhdGEgPSBbXTtcblxuXHRcdHZhciB0aWNrRHVyYXRpb24gPSB0aGlzLmdldFRpY2tEdXJhdGlvbih0aGlzLmR1cmF0aW9uLCAnbm90ZScpO1xuXHRcdHZhciByZXN0RHVyYXRpb24gPSB0aGlzLmdldFRpY2tEdXJhdGlvbih0aGlzLndhaXQsICdyZXN0Jyk7XG5cblx0XHQvLyBmaWVsZHMucGl0Y2ggY291bGQgYmUgYW4gYXJyYXkgb2YgcGl0Y2hlcy5cblx0XHQvLyBJZiBzbyBjcmVhdGUgbm90ZSBldmVudHMgZm9yIGVhY2ggYW5kIGFwcGx5IHRoZSBzYW1lIGR1cmF0aW9uLlxuXHRcdHZhciBub3RlT24sIG5vdGVPZmY7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkodGhpcy5waXRjaCkpIHtcblx0XHRcdC8vIEJ5IGRlZmF1bHQgdGhpcyBpcyBhIGNob3JkIGlmIGl0J3MgYW4gYXJyYXkgb2Ygbm90ZXMgdGhhdCByZXF1aXJlcyBvbmUgTm90ZU9uRXZlbnQuXG5cdFx0XHQvLyBJZiB0aGlzLnNlcXVlbnRpYWwgPT09IHRydWUgdGhlbiBpdCdzIGEgc2VxdWVudGlhbCBzdHJpbmcgb2Ygbm90ZXMgdGhhdCByZXF1aXJlcyBzZXBhcmF0ZSBOb3RlT25FdmVudHMuXG5cdFx0XHRpZiAoICEgdGhpcy5zZXF1ZW50aWFsKSB7XG5cdFx0XHRcdC8vIEhhbmRsZSByZXBlYXRcblx0XHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLnJlcGVhdDsgaisrKSB7XG5cdFx0XHRcdFx0Ly8gTm90ZSBvblxuXHRcdFx0XHRcdHRoaXMucGl0Y2guZm9yRWFjaChmdW5jdGlvbihwLCBpKSB7XG5cdFx0XHRcdFx0XHRpZiAoaSA9PSAwKSB7XG5cdFx0XHRcdFx0XHRcdG5vdGVPbiA9IG5ldyBOb3RlT25FdmVudCh7ZGF0YTogVXRpbHMubnVtYmVyVG9WYXJpYWJsZUxlbmd0aChyZXN0RHVyYXRpb24pLmNvbmNhdCh0aGlzLmdldE5vdGVPblN0YXR1cygpLCBVdGlscy5nZXRQaXRjaChwKSwgdGhpcy52ZWxvY2l0eSl9KTtcblxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Ly8gUnVubmluZyBzdGF0dXMgKGNhbiBvbW1pdCB0aGUgbm90ZSBvbiBzdGF0dXMpXG5cdFx0XHRcdFx0XHRcdG5vdGVPbiA9IG5ldyBOb3RlT25FdmVudCh7ZGF0YTogWzAsIFV0aWxzLmdldFBpdGNoKHApLCB0aGlzLnZlbG9jaXR5XX0pO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGEgPSB0aGlzLmRhdGEuY29uY2F0KG5vdGVPbi5kYXRhKTtcblx0XHRcdFx0XHR9LCB0aGlzKTtcblxuXHRcdFx0XHRcdC8vIE5vdGUgb2ZmXG5cdFx0XHRcdFx0dGhpcy5waXRjaC5mb3JFYWNoKGZ1bmN0aW9uKHAsIGkpIHtcblx0XHRcdFx0XHRcdGlmIChpID09IDApIHtcblx0XHRcdFx0XHRcdFx0bm90ZU9mZiA9IG5ldyBOb3RlT2ZmRXZlbnQoe2RhdGE6IFV0aWxzLm51bWJlclRvVmFyaWFibGVMZW5ndGgodGlja0R1cmF0aW9uKS5jb25jYXQodGhpcy5nZXROb3RlT2ZmU3RhdHVzKCksIFV0aWxzLmdldFBpdGNoKHApLCB0aGlzLnZlbG9jaXR5KX0pO1xuXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQvLyBSdW5uaW5nIHN0YXR1cyAoY2FuIG9tbWl0IHRoZSBub3RlIG9mZiBzdGF0dXMpXG5cdFx0XHRcdFx0XHRcdG5vdGVPZmYgPSBuZXcgTm90ZU9mZkV2ZW50KHtkYXRhOiBbMCwgVXRpbHMuZ2V0UGl0Y2gocCksIHRoaXMudmVsb2NpdHldfSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0YSA9IHRoaXMuZGF0YS5jb25jYXQobm90ZU9mZi5kYXRhKTtcblx0XHRcdFx0XHR9LCB0aGlzKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBIYW5kbGUgcmVwZWF0XG5cdFx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5yZXBlYXQ7IGorKykge1xuXHRcdFx0XHRcdHRoaXMucGl0Y2guZm9yRWFjaChmdW5jdGlvbihwLCBpKSB7XG5cdFx0XHRcdFx0XHQvLyByZXN0RHVyYXRpb24gb25seSBhcHBsaWVzIHRvIGZpcnN0IG5vdGVcblx0XHRcdFx0XHRcdGlmIChpID4gMCkge1xuXHRcdFx0XHRcdFx0XHRyZXN0RHVyYXRpb24gPSAwO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBJZiBkdXJhdGlvbiBpcyA4dGggdHJpcGxldHMgd2UgbmVlZCB0byBtYWtlIHN1cmUgdGhhdCB0aGUgdG90YWwgdGlja3MgPT0gcXVhcnRlciBub3RlLlxuXHRcdFx0XHRcdFx0Ly8gU28sIHRoZSBsYXN0IG9uZSB3aWxsIG5lZWQgdG8gYmUgdGhlIHJlbWFpbmRlclxuXHRcdFx0XHRcdFx0aWYgKHRoaXMuZHVyYXRpb24gPT09ICc4dCcgJiYgaSA9PSB0aGlzLnBpdGNoLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHF1YXJ0ZXJUaWNrcyA9IFV0aWxzLm51bWJlckZyb21CeXRlcyhDb25zdGFudHMuSEVBREVSX0NIVU5LX0RJVklTSU9OKTtcblx0XHRcdFx0XHRcdFx0dGlja0R1cmF0aW9uID0gcXVhcnRlclRpY2tzIC0gKHRpY2tEdXJhdGlvbiAqIDIpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRub3RlT24gPSBuZXcgTm90ZU9uRXZlbnQoe2RhdGE6IFV0aWxzLm51bWJlclRvVmFyaWFibGVMZW5ndGgocmVzdER1cmF0aW9uKS5jb25jYXQoW3RoaXMuZ2V0Tm90ZU9uU3RhdHVzKCksIFV0aWxzLmdldFBpdGNoKHApLCB0aGlzLnZlbG9jaXR5XSl9KTtcblx0XHRcdFx0XHRcdG5vdGVPZmYgPSBuZXcgTm90ZU9mZkV2ZW50KHtkYXRhOiBVdGlscy5udW1iZXJUb1ZhcmlhYmxlTGVuZ3RoKHRpY2tEdXJhdGlvbikuY29uY2F0KFt0aGlzLmdldE5vdGVPZmZTdGF0dXMoKSwgVXRpbHMuZ2V0UGl0Y2gocCksIHRoaXMudmVsb2NpdHldKX0pO1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGEgPSB0aGlzLmRhdGEuY29uY2F0KG5vdGVPbi5kYXRhLCBub3RlT2ZmLmRhdGEpO1xuXHRcdFx0XHRcdH0sIHRoaXMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHRocm93ICdwaXRjaCBtdXN0IGJlIGFuIGFycmF5Lic7XG5cdH07XG5cblx0LyoqXG5cdCAqIENvbnZlcnRzIHZlbG9jaXR5IHRvIHZhbHVlIDAtMTI3XG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB2ZWxvY2l0eSAtIFZlbG9jaXR5IHZhbHVlIDEtMTAwXG5cdCAqIEByZXR1cm4ge251bWJlcn1cblx0ICovXG5cdGNvbnZlcnRWZWxvY2l0eSh2ZWxvY2l0eSkge1xuXHRcdC8vIE1heCBwYXNzZWQgdmFsdWUgbGltaXRlZCB0byAxMDBcblx0XHR2ZWxvY2l0eSA9IHZlbG9jaXR5ID4gMTAwID8gMTAwIDogdmVsb2NpdHk7XG5cdFx0cmV0dXJuIE1hdGgucm91bmQodmVsb2NpdHkgLyAxMDAgKiAxMjcpO1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBHZXRzIHRoZSB0b3RhbCBudW1iZXIgb2YgdGlja3MgYmFzZWQgb24gcGFzc2VkIGR1cmF0aW9uLlxuXHQgKiBOb3RlOiB0eXBlPT0nbm90ZScgZGVmYXVsdHMgdG8gcXVhcnRlciBub3RlLCB0eXBlPT09J3Jlc3QnIGRlZmF1bHRzIHRvIDBcblx0ICogQHBhcmFtIHsoc3RyaW5nfGFycmF5KX0gZHVyYXRpb25cblx0ICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgWydub3RlJywgJ3Jlc3QnXVxuXHQgKiBAcmV0dXJuIHtudW1iZXJ9XG5cdCAqL1xuXHRnZXRUaWNrRHVyYXRpb24oZHVyYXRpb24sIHR5cGUpIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShkdXJhdGlvbikpIHtcblx0XHRcdC8vIFJlY3Vyc2l2ZWx5IGV4ZWN1dGUgdGhpcyBtZXRob2QgZm9yIGVhY2ggaXRlbSBpbiB0aGUgYXJyYXkgYW5kIHJldHVybiB0aGUgc3VtIG9mIHRpY2sgZHVyYXRpb25zLlxuXHRcdFx0cmV0dXJuIGR1cmF0aW9uLm1hcChmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5nZXRUaWNrRHVyYXRpb24odmFsdWUsIHR5cGUpO1xuXHRcdFx0fSwgdGhpcykucmVkdWNlKGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRcdFx0cmV0dXJuIGEgKyBiO1xuXHRcdFx0fSwgMCk7XG5cdFx0fVxuXG5cdFx0ZHVyYXRpb24gPSBkdXJhdGlvbi50b1N0cmluZygpO1xuXG5cdFx0aWYgKGR1cmF0aW9uLnRvTG93ZXJDYXNlKCkuY2hhckF0KDApID09PSAndCcpIHtcblx0XHRcdC8vIElmIGR1cmF0aW9uIHN0YXJ0cyB3aXRoICd0JyB0aGVuIHRoZSBudW1iZXIgdGhhdCBmb2xsb3dzIGlzIGFuIGV4cGxpY2l0IHRpY2sgY291bnRcblx0XHRcdHJldHVybiBwYXJzZUludChkdXJhdGlvbi5zdWJzdHJpbmcoMSkpO1xuXHRcdH1cblxuXHRcdC8vIE5lZWQgdG8gYXBwbHkgZHVyYXRpb24gaGVyZS4gIFF1YXJ0ZXIgbm90ZSA9PSBDb25zdGFudHMuSEVBREVSX0NIVU5LX0RJVklTSU9OXG5cdFx0Ly8gUm91bmRpbmcgb25seSBhcHBsaWVzIHRvIHRyaXBsZXRzLCB3aGljaCB0aGUgcmVtYWluZGVyIGlzIGhhbmRsZWQgYmVsb3dcblx0XHR2YXIgcXVhcnRlclRpY2tzID0gVXRpbHMubnVtYmVyRnJvbUJ5dGVzKENvbnN0YW50cy5IRUFERVJfQ0hVTktfRElWSVNJT04pO1xuXHRcdHJldHVybiBNYXRoLnJvdW5kKHF1YXJ0ZXJUaWNrcyAqIHRoaXMuZ2V0RHVyYXRpb25NdWx0aXBsaWVyKGR1cmF0aW9uLCB0eXBlKSk7XG5cdH1cblxuXHQvKipcblx0ICogR2V0cyB3aGF0IHRvIG11bHRpcGxlIHRpY2tzL3F1YXJ0ZXIgbm90ZSBieSB0byBnZXQgdGhlIHNwZWNpZmllZCBkdXJhdGlvbi5cblx0ICogTm90ZTogdHlwZT09J25vdGUnIGRlZmF1bHRzIHRvIHF1YXJ0ZXIgbm90ZSwgdHlwZT09PSdyZXN0JyBkZWZhdWx0cyB0byAwXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBkdXJhdGlvblxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBbJ25vdGUnLCdyZXN0J11cblx0ICogQHJldHVybiB7bnVtYmVyfVxuXHQgKi9cblx0Z2V0RHVyYXRpb25NdWx0aXBsaWVyKGR1cmF0aW9uLCB0eXBlKSB7XG5cdFx0Ly8gTmVlZCB0byBhcHBseSBkdXJhdGlvbiBoZXJlLiAgUXVhcnRlciBub3RlID09IENvbnN0YW50cy5IRUFERVJfQ0hVTktfRElWSVNJT05cblx0XHRzd2l0Y2ggKGR1cmF0aW9uKSB7XG5cdFx0XHRjYXNlICcwJzpcblx0XHRcdFx0cmV0dXJuIDA7XG5cdFx0XHRjYXNlICcxJzpcblx0XHRcdFx0cmV0dXJuIDQ7XG5cdFx0XHRjYXNlICcyJzpcblx0XHRcdFx0cmV0dXJuIDI7XG5cdFx0XHRjYXNlICdkMic6XG5cdFx0XHRcdHJldHVybiAzO1xuXHRcdFx0Y2FzZSAnNCc6XG5cdFx0XHRcdHJldHVybiAxO1xuXHRcdFx0Y2FzZSAnZDQnOlxuXHRcdFx0XHRyZXR1cm4gMS41O1xuXHRcdFx0Y2FzZSAnOCc6XG5cdFx0XHRcdHJldHVybiAwLjU7XG5cdFx0XHRjYXNlICc4dCc6XG5cdFx0XHRcdC8vIEZvciA4dGggdHJpcGxldHMsIGxldCdzIGRpdmlkZSBhIHF1YXJ0ZXIgYnkgMywgcm91bmQgdG8gdGhlIG5lYXJlc3QgaW50LCBhbmQgc3Vic3RyYWN0IHRoZSByZW1haW5kZXIgdG8gdGhlIGxhc3Qgb25lLlxuXHRcdFx0XHRyZXR1cm4gMC4zMztcblx0XHRcdGNhc2UgJ2Q4Jzpcblx0XHRcdFx0cmV0dXJuIDAuNzU7XG5cdFx0XHRjYXNlICcxNic6XG5cdFx0XHRcdHJldHVybiAwLjI1O1xuXHRcdFx0Y2FzZSAnMzInOlxuXHRcdFx0XHRyZXR1cm4gMC4xMjU7XG5cdFx0XHRjYXNlICc2NCc6XG5cdFx0XHRcdHJldHVybiAwLjA2MjU7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHQvLyBOb3RlcyBkZWZhdWx0IHRvIGEgcXVhcnRlciwgcmVzdHMgZGVmYXVsdCB0byAwXG5cdFx0XHRcdC8vcmV0dXJuIHR5cGUgPT09ICdub3RlJyA/IDEgOiAwO1xuXHRcdH1cblxuXHRcdHRocm93IGR1cmF0aW9uICsgJyBpcyBub3QgYSB2YWxpZCBkdXJhdGlvbi4nO1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBHZXRzIHRoZSBub3RlIG9uIHN0YXR1cyBjb2RlIGJhc2VkIG9uIHRoZSBzZWxlY3RlZCBjaGFubmVsLiAweDl7MC1GfVxuXHQgKiBOb3RlIG9uIGF0IGNoYW5uZWwgMCBpcyAweDkwICgxNDQpXG5cdCAqIDAgPSBDaCAxXG5cdCAqIEByZXR1cm4ge251bWJlcn1cblx0ICovXG5cdGdldE5vdGVPblN0YXR1cygpIHtyZXR1cm4gMTQ0ICsgdGhpcy5jaGFubmVsIC0gMX1cblxuXHQvKipcblx0ICogR2V0cyB0aGUgbm90ZSBvZmYgc3RhdHVzIGNvZGUgYmFzZWQgb24gdGhlIHNlbGVjdGVkIGNoYW5uZWwuIDB4OHswLUZ9XG5cdCAqIE5vdGUgb2ZmIGF0IGNoYW5uZWwgMCBpcyAweDgwICgxMjgpXG5cdCAqIDAgPSBDaCAxXG5cdCAqIEByZXR1cm4ge251bWJlcn1cblx0ICovXG5cdGdldE5vdGVPZmZTdGF0dXMoKSB7cmV0dXJuIDEyOCArIHRoaXMuY2hhbm5lbCAtIDF9XG59XG5cbmV4cG9ydCB7Tm90ZUV2ZW50fTtcbiJdfQ==
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * Holds all data for a "note off" MIDI event
 * @param {object} fields {data: []}
 * @return {NoteOffEvent}
 */
var NoteOffEvent = function NoteOffEvent(fields) {
  _classCallCheck(this, NoteOffEvent);

  this.data = fields.data;
};

exports.NoteOffEvent = NoteOffEvent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9ub3RlLW9mZi1ldmVudC5qcyJdLCJuYW1lcyI6WyJOb3RlT2ZmRXZlbnQiLCJmaWVsZHMiLCJkYXRhIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7OztJQUtNQSxZLEdBQ0wsc0JBQVlDLE1BQVosRUFBb0I7QUFBQTs7QUFDbkIsT0FBS0MsSUFBTCxHQUFZRCxPQUFPQyxJQUFuQjtBQUNBLEM7O1FBR01GLFksR0FBQUEsWSIsImZpbGUiOiJub3RlLW9mZi1ldmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSG9sZHMgYWxsIGRhdGEgZm9yIGEgXCJub3RlIG9mZlwiIE1JREkgZXZlbnRcbiAqIEBwYXJhbSB7b2JqZWN0fSBmaWVsZHMge2RhdGE6IFtdfVxuICogQHJldHVybiB7Tm90ZU9mZkV2ZW50fVxuICovXG5jbGFzcyBOb3RlT2ZmRXZlbnQge1xuXHRjb25zdHJ1Y3RvcihmaWVsZHMpIHtcblx0XHR0aGlzLmRhdGEgPSBmaWVsZHMuZGF0YTtcblx0fVxufVxuXG5leHBvcnQge05vdGVPZmZFdmVudH07XG4iXX0=
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * Holds all data for a "note on" MIDI event
 * @param {object} fields {data: []}
 * @return {NoteOnEvent}
 */
var NoteOnEvent = function NoteOnEvent(fields) {
  _classCallCheck(this, NoteOnEvent);

  this.data = fields.data;
};

exports.NoteOnEvent = NoteOnEvent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9ub3RlLW9uLWV2ZW50LmpzIl0sIm5hbWVzIjpbIk5vdGVPbkV2ZW50IiwiZmllbGRzIiwiZGF0YSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7Ozs7SUFLTUEsVyxHQUNMLHFCQUFZQyxNQUFaLEVBQW9CO0FBQUE7O0FBQ25CLE9BQUtDLElBQUwsR0FBWUQsT0FBT0MsSUFBbkI7QUFDQSxDOztRQUdNRixXLEdBQUFBLFciLCJmaWxlIjoibm90ZS1vbi1ldmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSG9sZHMgYWxsIGRhdGEgZm9yIGEgXCJub3RlIG9uXCIgTUlESSBldmVudFxuICogQHBhcmFtIHtvYmplY3R9IGZpZWxkcyB7ZGF0YTogW119XG4gKiBAcmV0dXJuIHtOb3RlT25FdmVudH1cbiAqL1xuY2xhc3MgTm90ZU9uRXZlbnQge1xuXHRjb25zdHJ1Y3RvcihmaWVsZHMpIHtcblx0XHR0aGlzLmRhdGEgPSBmaWVsZHMuZGF0YTtcblx0fVxufVxuXG5leHBvcnQge05vdGVPbkV2ZW50fTtcbiJdfQ==
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * Holds all data for a "program change" MIDI event
 * @param {object} fields {type: string, data: []}
 * @return {NoteOffEvent}
 */
var ProgramChangeEvent = function ProgramChangeEvent(fields) {
	_classCallCheck(this, ProgramChangeEvent);

	this.type = 'program';
	// delta time defaults to 0.
	this.data = Utils.numberToVariableLength(0x00).concat(Constants.PROGRAM_CHANGE_STATUS, fields.instrument);
};

exports.ProgramChangeEvent = ProgramChangeEvent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wcm9ncmFtLWNoYW5nZS1ldmVudC5qcyJdLCJuYW1lcyI6WyJQcm9ncmFtQ2hhbmdlRXZlbnQiLCJmaWVsZHMiLCJ0eXBlIiwiZGF0YSIsIlV0aWxzIiwibnVtYmVyVG9WYXJpYWJsZUxlbmd0aCIsImNvbmNhdCIsIkNvbnN0YW50cyIsIlBST0dSQU1fQ0hBTkdFX1NUQVRVUyIsImluc3RydW1lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7O0lBS01BLGtCLEdBQ0wsNEJBQVlDLE1BQVosRUFBb0I7QUFBQTs7QUFDbkIsTUFBS0MsSUFBTCxHQUFZLFNBQVo7QUFDQTtBQUNBLE1BQUtDLElBQUwsR0FBWUMsTUFBTUMsc0JBQU4sQ0FBNkIsSUFBN0IsRUFBbUNDLE1BQW5DLENBQTBDQyxVQUFVQyxxQkFBcEQsRUFBMkVQLE9BQU9RLFVBQWxGLENBQVo7QUFDQSxDOztRQUdNVCxrQixHQUFBQSxrQiIsImZpbGUiOiJwcm9ncmFtLWNoYW5nZS1ldmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSG9sZHMgYWxsIGRhdGEgZm9yIGEgXCJwcm9ncmFtIGNoYW5nZVwiIE1JREkgZXZlbnRcbiAqIEBwYXJhbSB7b2JqZWN0fSBmaWVsZHMge3R5cGU6IHN0cmluZywgZGF0YTogW119XG4gKiBAcmV0dXJuIHtOb3RlT2ZmRXZlbnR9XG4gKi9cbmNsYXNzIFByb2dyYW1DaGFuZ2VFdmVudCB7XG5cdGNvbnN0cnVjdG9yKGZpZWxkcykge1xuXHRcdHRoaXMudHlwZSA9ICdwcm9ncmFtJztcblx0XHQvLyBkZWx0YSB0aW1lIGRlZmF1bHRzIHRvIDAuXG5cdFx0dGhpcy5kYXRhID0gVXRpbHMubnVtYmVyVG9WYXJpYWJsZUxlbmd0aCgweDAwKS5jb25jYXQoQ29uc3RhbnRzLlBST0dSQU1fQ0hBTkdFX1NUQVRVUywgZmllbGRzLmluc3RydW1lbnQpO1xuXHR9XG59XG5cbmV4cG9ydCB7UHJvZ3JhbUNoYW5nZUV2ZW50fTtcbiJdfQ==
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * Holds all data for a track.
 * @param {object} fields {type: number, data: array, size: array, events: array}
 * @return {Track}
 */
var Track = function () {
	function Track() {
		_classCallCheck(this, Track);

		this.type = Constants.TRACK_CHUNK_TYPE;
		this.data = [];
		this.size = [];
		this.events = [];
	}

	/**
  * Adds any event type to the track.
  * @param {(NoteEvent|MetaEvent|ProgramChangeEvent)} event - Event object.
  * @param {function} mapFunction - Callback which can be used to apply specific properties to all events. 
  * @return {Track}
  */


	_createClass(Track, [{
		key: 'addEvent',
		value: function addEvent(event, mapFunction) {
			if (Array.isArray(event)) {
				event.forEach(function (e, i) {
					// Handle map function if provided
					if (typeof mapFunction === 'function' && e.type === 'note') {
						var properties = mapFunction(i, e);

						if ((typeof properties === 'undefined' ? 'undefined' : _typeof(properties)) === 'object') {
							for (var j in properties) {
								switch (j) {
									case 'duration':
										e.duration = properties[j];
										break;
									case 'sequential':
										e.sequential = properties[j];
										break;
									case 'velocity':
										e.velocity = e.convertVelocity(properties[j]);
										break;
								}
							}

							// Gotta build that data
							e.buildData();
						}
					}

					this.data = this.data.concat(e.data);
					this.size = Utils.numberToBytes(this.data.length, 4); // 4 bytes long
					this.events.push(e);
				}, this);
			} else {
				this.data = this.data.concat(event.data);
				this.size = Utils.numberToBytes(this.data.length, 4); // 4 bytes long
				this.events.push(event);
			}

			return this;
		}

		/**
   * Sets tempo of the MIDI file.
   * @param {number} bpm - Tempo in beats per minute.
   * @return {Track}
   */

	}, {
		key: 'setTempo',
		value: function setTempo(bpm) {
			var event = new MetaEvent({ data: [Constants.META_TEMPO_ID] });
			event.data.push(0x03); // Size
			var tempo = Math.round(60000000 / bpm);
			event.data = event.data.concat(Utils.numberToBytes(tempo, 3)); // Tempo, 3 bytes
			return this.addEvent(event);
		}

		/**
   * Sets time signature.
   * @param {number} numerator - Top number of the time signature.
   * @param {number} denominator - Bottom number of the time signature.
   * @param {number} midiclockspertick - Defaults to 24.
   * @param {number} notespermidiclock - Defaults to 8.
   * @return {Track}
   */

	}, {
		key: 'setTimeSignature',
		value: function setTimeSignature(numerator, denominator, midiclockspertick, notespermidiclock) {
			midiclockspertick = midiclockspertick || 24;
			notespermidiclock = notespermidiclock || 8;

			var event = new MetaEvent({ data: [Constants.META_TIME_SIGNATURE_ID] });
			event.data.push(0x04); // Size
			event.data = event.data.concat(Utils.numberToBytes(numerator, 1)); // Numerator, 1 bytes

			var _denominator = Math.log2(denominator); // Denominator is expressed as pow of 2
			event.data = event.data.concat(Utils.numberToBytes(_denominator, 1)); // Denominator, 1 bytes
			event.data = event.data.concat(Utils.numberToBytes(midiclockspertick, 1)); // MIDI Clocks per tick, 1 bytes
			event.data = event.data.concat(Utils.numberToBytes(notespermidiclock, 1)); // Number of 1/32 notes per MIDI clocks, 1 bytes
			return this.addEvent(event);
		}

		/**
   * Sets key signature.
   * @param {*} sf - 
   * @param {*} mi -
   * @return {Track}
   */

	}, {
		key: 'setKeySignature',
		value: function setKeySignature(sf, mi) {
			var event = new MetaEvent({ data: [Constants.META_KEY_SIGNATURE_ID] });
			event.data.push(0x02); // Size

			var mode = mi || 0;
			sf = sf || 0;

			//	Function called with string notation
			if (typeof mi === 'undefined') {
				var fifths = [['Cb', 'Gb', 'Db', 'Ab', 'Eb', 'Bb', 'F', 'C', 'G', 'D', 'A', 'E', 'B', 'F#', 'C#'], ['ab', 'eb', 'bb', 'f', 'c', 'g', 'd', 'a', 'e', 'b', 'f#', 'c#', 'g#', 'd#', 'a#']];
				var _sflen = sf.length;
				var note = sf || 'C';

				if (sf[0] === sf[0].toLowerCase()) mode = 1;

				if (_sflen > 1) {
					switch (sf.charAt(_sflen - 1)) {
						case 'm':
							mode = 1;
							note = sf.charAt(0).toLowerCase();
							note = note.concat(sf.substring(1, _sflen - 1));
							break;
						case '-':
							mode = 1;
							note = sf.charAt(0).toLowerCase();
							note = note.concat(sf.substring(1, _sflen - 1));
							break;
						case 'M':
							mode = 0;
							note = sf.charAt(0).toUpperCase();
							note = note.concat(sf.substring(1, _sflen - 1));
							break;
						case '+':
							mode = 0;
							note = sf.charAt(0).toUpperCase();
							note = note.concat(sf.substring(1, _sflen - 1));
							break;
					}
				}

				var fifthindex = fifths[mode].indexOf(note);
				sf = fifthindex === -1 ? 0 : fifthindex - 7;
			}

			event.data = event.data.concat(Utils.numberToBytes(sf, 1)); // Number of sharp or flats ( < 0 flat; > 0 sharp)
			event.data = event.data.concat(Utils.numberToBytes(mode, 1)); // Mode: 0 major, 1 minor
			return this.addEvent(event);
		}

		/**
   * Adds text to MIDI file.
   * @param {string} text - Text to add.
   * @return {Track}
   */

	}, {
		key: 'addText',
		value: function addText(text) {
			var event = new MetaEvent({ data: [Constants.META_TEXT_ID] });
			var stringBytes = Utils.stringToBytes(text);
			event.data = event.data.concat(Utils.numberToVariableLength(stringBytes.length)); // Size
			event.data = event.data.concat(stringBytes); // Text
			return this.addEvent(event);
		}

		/**
   * Adds copyright to MIDI file.
   * @param {string} text - Text of copyright line.
   * @return {Track}
   */

	}, {
		key: 'addCopyright',
		value: function addCopyright(text) {
			var event = new MetaEvent({ data: [Constants.META_COPYRIGHT_ID] });
			var stringBytes = Utils.stringToBytes(text);
			event.data = event.data.concat(Utils.numberToVariableLength(stringBytes.length)); // Size
			event.data = event.data.concat(stringBytes); // Text
			return this.addEvent(event);
		}

		/**
   * Adds Sequence/Track Name.
   * @param {string} text - Text of track name.
   * @return {Track}
   */

	}, {
		key: 'addTrackName',
		value: function addTrackName(text) {
			var event = new MetaEvent({ data: [Constants.META_TRACK_NAME_ID] });
			var stringBytes = Utils.stringToBytes(text);
			event.data = event.data.concat(Utils.numberToVariableLength(stringBytes.length)); // Size
			event.data = event.data.concat(stringBytes); // Text
			return this.addEvent(event);
		}

		/**
   * Sets instrument name of track.
   * @param {string} text - Name of instrument.
   * @return {Track}
   */

	}, {
		key: 'addInstrumentName',
		value: function addInstrumentName(text) {
			var event = new MetaEvent({ data: [Constants.META_INSTRUMENT_NAME_ID] });
			var stringBytes = Utils.stringToBytes(text);
			event.data = event.data.concat(Utils.numberToVariableLength(stringBytes.length)); // Size
			event.data = event.data.concat(stringBytes); // Text
			return this.addEvent(event);
		}

		/**
   * Adds marker to MIDI file.
   * @param {string} text - Marker text.
   * @return {Track}
   */

	}, {
		key: 'addMarker',
		value: function addMarker(text) {
			var event = new MetaEvent({ data: [Constants.META_MARKER_ID] });
			var stringBytes = Utils.stringToBytes(text);
			event.data = event.data.concat(Utils.numberToVariableLength(stringBytes.length)); // Size
			event.data = event.data.concat(stringBytes); // Text
			return this.addEvent(event);
		}

		/**
   * Adds cue point to MIDI file.
   * @param {string} text - Text of cue point.
   * @return {Track}
   */

	}, {
		key: 'addCuePoint',
		value: function addCuePoint(text) {
			var event = new MetaEvent({ data: [Constants.META_CUE_POINT] });
			var stringBytes = Utils.stringToBytes(text);
			event.data = event.data.concat(Utils.numberToVariableLength(stringBytes.length)); // Size
			event.data = event.data.concat(stringBytes); // Text
			return this.addEvent(event);
		}

		/**
   * Adds lyric to MIDI file.
   * @param {string} lyric - Lyric text to add.
   * @return {Track}
   */

	}, {
		key: 'addLyric',
		value: function addLyric(lyric) {
			var event = new MetaEvent({ data: [Constants.META_LYRIC_ID] });
			var stringBytes = Utils.stringToBytes(lyric);
			event.data = event.data.concat(Utils.numberToVariableLength(stringBytes.length)); // Size
			event.data = event.data.concat(stringBytes); // Lyric
			return this.addEvent(event);
		}

		/**
   * Channel mode messages
   * @return {Track}
   */

	}, {
		key: 'polyModeOn',
		value: function polyModeOn() {
			var event = new NoteOnEvent({ data: [0x00, 0xB0, 0x7E, 0x00] });
			return this.addEvent(event);
		}
	}]);

	return Track;
}();

exports.Track = Track;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90cmFjay5qcyJdLCJuYW1lcyI6WyJUcmFjayIsInR5cGUiLCJDb25zdGFudHMiLCJUUkFDS19DSFVOS19UWVBFIiwiZGF0YSIsInNpemUiLCJldmVudHMiLCJldmVudCIsIm1hcEZ1bmN0aW9uIiwiQXJyYXkiLCJpc0FycmF5IiwiZm9yRWFjaCIsImUiLCJpIiwicHJvcGVydGllcyIsImoiLCJkdXJhdGlvbiIsInNlcXVlbnRpYWwiLCJ2ZWxvY2l0eSIsImNvbnZlcnRWZWxvY2l0eSIsImJ1aWxkRGF0YSIsImNvbmNhdCIsIlV0aWxzIiwibnVtYmVyVG9CeXRlcyIsImxlbmd0aCIsInB1c2giLCJicG0iLCJNZXRhRXZlbnQiLCJNRVRBX1RFTVBPX0lEIiwidGVtcG8iLCJNYXRoIiwicm91bmQiLCJhZGRFdmVudCIsIm51bWVyYXRvciIsImRlbm9taW5hdG9yIiwibWlkaWNsb2Nrc3BlcnRpY2siLCJub3Rlc3Blcm1pZGljbG9jayIsIk1FVEFfVElNRV9TSUdOQVRVUkVfSUQiLCJfZGVub21pbmF0b3IiLCJsb2cyIiwic2YiLCJtaSIsIk1FVEFfS0VZX1NJR05BVFVSRV9JRCIsIm1vZGUiLCJmaWZ0aHMiLCJfc2ZsZW4iLCJub3RlIiwidG9Mb3dlckNhc2UiLCJjaGFyQXQiLCJzdWJzdHJpbmciLCJ0b1VwcGVyQ2FzZSIsImZpZnRoaW5kZXgiLCJpbmRleE9mIiwidGV4dCIsIk1FVEFfVEVYVF9JRCIsInN0cmluZ0J5dGVzIiwic3RyaW5nVG9CeXRlcyIsIm51bWJlclRvVmFyaWFibGVMZW5ndGgiLCJNRVRBX0NPUFlSSUdIVF9JRCIsIk1FVEFfVFJBQ0tfTkFNRV9JRCIsIk1FVEFfSU5TVFJVTUVOVF9OQU1FX0lEIiwiTUVUQV9NQVJLRVJfSUQiLCJNRVRBX0NVRV9QT0lOVCIsImx5cmljIiwiTUVUQV9MWVJJQ19JRCIsIk5vdGVPbkV2ZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7SUFLTUEsSztBQUNMLGtCQUFjO0FB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QWQsQ0FBUDtBQUNBOzs7Ozs7UUFJTVAsSyxHQUFBQSxLIiwiZmlsZSI6InRyYWNrLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBIb2xkcyBhbGwgZGF0YSBmb3IgYSB0cmFjay5cbiAqIEBwYXJhbSB7b2JqZWN0fSBmaWVsZHMge3R5cGU6IG51bWJlciwgZGF0YTogYXJyYXksIHNpemU6IGFycmF5LCBldmVudHM6IGFycmF5fVxuICogQHJldHVybiB7VHJhY2t9XG4gKi9cbmNsYXNzIFRyYWNrIHtcblx0Y29uc3RydWN0b3IoKSB7XG5cdFx0dGhpcy50eXBlID0gQ29uc3RhbnRzLlRSQUNLX0NIVU5LX1RZUEU7XG5cdFx0dGhpcy5kYXRhID0gW107XG5cdFx0dGhpcy5zaXplID0gW107XG5cdFx0dGhpcy5ldmVudHMgPSBbXTtcblx0fVxuXG5cdC8qKlxuXHQgKiBBZGRzIGFueSBldmVudCB0eXBlIHRvIHRoZSB0cmFjay5cblx0ICogQHBhcmFtIHsoTm90ZUV2ZW50fE1ldGFFdmVudHxQcm9ncmFtQ2hhbmdlRXZlbnQpfSBldmVudCAtIEV2ZW50IG9iamVjdC5cblx0ICogQHBhcmFtIHtmdW5jdGlvbn0gbWFwRnVuY3Rpb24gLSBDYWxsYmFjayB3aGljaCBjYW4gYmUgdXNlZCB0byBhcHBseSBzcGVjaWZpYyBwcm9wZXJ0aWVzIHRvIGFsbCBldmVudHMuIFxuXHQgKiBAcmV0dXJuIHtUcmFja31cblx0ICovXG5cdGFkZEV2ZW50KGV2ZW50LCBtYXBGdW5jdGlvbikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KGV2ZW50KSkge1xuXHRcdFx0ZXZlbnQuZm9yRWFjaChmdW5jdGlvbihlLCBpKSB7XG5cdFx0XHRcdC8vIEhhbmRsZSBtYXAgZnVuY3Rpb24gaWYgcHJvdmlkZWRcblx0XHRcdFx0aWYgKHR5cGVvZiBtYXBGdW5jdGlvbiA9PT0gJ2Z1bmN0aW9uJyAmJiBlLnR5cGUgPT09ICdub3RlJykge1xuXHRcdFx0XHRcdHZhciBwcm9wZXJ0aWVzID0gbWFwRnVuY3Rpb24oaSwgZSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mIHByb3BlcnRpZXMgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRcdFx0XHRmb3IgKHZhciBqIGluIHByb3BlcnRpZXMpIHtcblx0XHRcdFx0XHRcdFx0c3dpdGNoKGopIHtcblx0XHRcdFx0XHRcdFx0XHRjYXNlICdkdXJhdGlvbic6XG5cdFx0XHRcdFx0XHRcdFx0XHRlLmR1cmF0aW9uID0gcHJvcGVydGllc1tqXTtcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdGNhc2UgJ3NlcXVlbnRpYWwnOlxuXHRcdFx0XHRcdFx0XHRcdFx0ZS5zZXF1ZW50aWFsID0gcHJvcGVydGllc1tqXTtcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdGNhc2UgJ3ZlbG9jaXR5Jzpcblx0XHRcdFx0XHRcdFx0XHRcdGUudmVsb2NpdHkgPSBlLmNvbnZlcnRWZWxvY2l0eShwcm9wZXJ0aWVzW2pdKTtcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XHRcdFxuXG5cdFx0XHRcdFx0XHQvLyBHb3R0YSBidWlsZCB0aGF0IGRhdGFcblx0XHRcdFx0XHRcdGUuYnVpbGREYXRhKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5kYXRhID0gdGhpcy5kYXRhLmNvbmNhdChlLmRhdGEpO1xuXHRcdFx0XHR0aGlzLnNpemUgPSBVdGlscy5udW1iZXJUb0J5dGVzKHRoaXMuZGF0YS5sZW5ndGgsIDQpOyAvLyA0IGJ5dGVzIGxvbmdcblx0XHRcdFx0dGhpcy5ldmVudHMucHVzaChlKTtcblx0XHRcdH0sIHRoaXMpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuZGF0YSA9IHRoaXMuZGF0YS5jb25jYXQoZXZlbnQuZGF0YSk7XG5cdFx0XHR0aGlzLnNpemUgPSBVdGlscy5udW1iZXJUb0J5dGVzKHRoaXMuZGF0YS5sZW5ndGgsIDQpOyAvLyA0IGJ5dGVzIGxvbmdcblx0XHRcdHRoaXMuZXZlbnRzLnB1c2goZXZlbnQpO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNldHMgdGVtcG8gb2YgdGhlIE1JREkgZmlsZS5cblx0ICogQHBhcmFtIHtudW1iZXJ9IGJwbSAtIFRlbXBvIGluIGJlYXRzIHBlciBtaW51dGUuXG5cdCAqIEByZXR1cm4ge1RyYWNrfVxuXHQgKi9cblx0c2V0VGVtcG8oYnBtKSB7XG5cdFx0dmFyIGV2ZW50ID0gbmV3IE1ldGFFdmVudCh7ZGF0YTogW0NvbnN0YW50cy5NRVRBX1RFTVBPX0lEXX0pO1xuXHRcdGV2ZW50LmRhdGEucHVzaCgweDAzKTsgLy8gU2l6ZVxuXHRcdHZhciB0ZW1wbyA9IE1hdGgucm91bmQoNjAwMDAwMDAgLyBicG0pO1xuXHRcdGV2ZW50LmRhdGEgPSBldmVudC5kYXRhLmNvbmNhdChVdGlscy5udW1iZXJUb0J5dGVzKHRlbXBvLCAzKSk7IC8vIFRlbXBvLCAzIGJ5dGVzXG5cdFx0cmV0dXJuIHRoaXMuYWRkRXZlbnQoZXZlbnQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNldHMgdGltZSBzaWduYXR1cmUuXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBudW1lcmF0b3IgLSBUb3AgbnVtYmVyIG9mIHRoZSB0aW1lIHNpZ25hdHVyZS5cblx0ICogQHBhcmFtIHtudW1iZXJ9IGRlbm9taW5hdG9yIC0gQm90dG9tIG51bWJlciBvZiB0aGUgdGltZSBzaWduYXR1cmUuXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBtaWRpY2xvY2tzcGVydGljayAtIERlZmF1bHRzIHRvIDI0LlxuXHQgKiBAcGFyYW0ge251bWJlcn0gbm90ZXNwZXJtaWRpY2xvY2sgLSBEZWZhdWx0cyB0byA4LlxuXHQgKiBAcmV0dXJuIHtUcmFja31cblx0ICovXG5cdHNldFRpbWVTaWduYXR1cmUobnVtZXJhdG9yLCBkZW5vbWluYXRvciwgbWlkaWNsb2Nrc3BlcnRpY2ssIG5vdGVzcGVybWlkaWNsb2NrKSB7XG5cdFx0bWlkaWNsb2Nrc3BlcnRpY2sgPSBtaWRpY2xvY2tzcGVydGljayB8fCAyNDtcblx0XHRub3Rlc3Blcm1pZGljbG9jayA9IG5vdGVzcGVybWlkaWNsb2NrIHx8IDg7XG5cdFx0XG5cdFx0dmFyIGV2ZW50ID0gbmV3IE1ldGFFdmVudCh7ZGF0YTogW0NvbnN0YW50cy5NRVRBX1RJTUVfU0lHTkFUVVJFX0lEXX0pO1xuXHRcdGV2ZW50LmRhdGEucHVzaCgweDA0KTsgLy8gU2l6ZVxuXHRcdGV2ZW50LmRhdGEgPSBldmVudC5kYXRhLmNvbmNhdChVdGlscy5udW1iZXJUb0J5dGVzKG51bWVyYXRvciwgMSkpOyAvLyBOdW1lcmF0b3IsIDEgYnl0ZXNcblx0XHRcblx0XHR2YXIgX2Rlbm9taW5hdG9yID0gTWF0aC5sb2cyKGRlbm9taW5hdG9yKTtcdC8vIERlbm9taW5hdG9yIGlzIGV4cHJlc3NlZCBhcyBwb3cgb2YgMlxuXHRcdGV2ZW50LmRhdGEgPSBldmVudC5kYXRhLmNvbmNhdChVdGlscy5udW1iZXJUb0J5dGVzKF9kZW5vbWluYXRvciwgMSkpOyAvLyBEZW5vbWluYXRvciwgMSBieXRlc1xuXHRcdGV2ZW50LmRhdGEgPSBldmVudC5kYXRhLmNvbmNhdChVdGlscy5udW1iZXJUb0J5dGVzKG1pZGljbG9ja3NwZXJ0aWNrLCAxKSk7IC8vIE1JREkgQ2xvY2tzIHBlciB0aWNrLCAxIGJ5dGVzXG5cdFx0ZXZlbnQuZGF0YSA9IGV2ZW50LmRhdGEuY29uY2F0KFV0aWxzLm51bWJlclRvQnl0ZXMobm90ZXNwZXJtaWRpY2xvY2ssIDEpKTsgLy8gTnVtYmVyIG9mIDEvMzIgbm90ZXMgcGVyIE1JREkgY2xvY2tzLCAxIGJ5dGVzXG5cdFx0cmV0dXJuIHRoaXMuYWRkRXZlbnQoZXZlbnQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNldHMga2V5IHNpZ25hdHVyZS5cblx0ICogQHBhcmFtIHsqfSBzZiAtIFxuXHQgKiBAcGFyYW0geyp9IG1pIC1cblx0ICogQHJldHVybiB7VHJhY2t9XG5cdCAqL1xuXHRzZXRLZXlTaWduYXR1cmUoc2YsIG1pKSB7XG5cdFx0dmFyIGV2ZW50ID0gbmV3IE1ldGFFdmVudCh7ZGF0YTogW0NvbnN0YW50cy5NRVRBX0tFWV9TSUdOQVRVUkVfSURdfSk7XG5cdFx0ZXZlbnQuZGF0YS5wdXNoKDB4MDIpOyAvLyBTaXplXG5cblx0XHR2YXIgbW9kZSA9IG1pIHx8IDA7XG5cdFx0c2YgPSBzZiB8fCAwO1xuXG5cdFx0Ly9cdEZ1bmN0aW9uIGNhbGxlZCB3aXRoIHN0cmluZyBub3RhdGlvblxuXHRcdGlmICh0eXBlb2YgbWkgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2YXIgZmlmdGhzID0gW1xuXHRcdFx0XHRbJ0NiJywgJ0diJywgJ0RiJywgJ0FiJywgJ0ViJywgJ0JiJywgJ0YnLCAnQycsICdHJywgJ0QnLCAnQScsICdFJywgJ0InLCAnRiMnLCAnQyMnXSxcblx0XHRcdFx0WydhYicsICdlYicsICdiYicsICdmJywgJ2MnLCAnZycsICdkJywgJ2EnLCAnZScsICdiJywgJ2YjJywgJ2MjJywgJ2cjJywgJ2QjJywgJ2EjJ11cblx0XHRcdF07XG5cdFx0XHR2YXIgX3NmbGVuID0gc2YubGVuZ3RoO1xuXHRcdFx0dmFyIG5vdGUgPSBzZiB8fCAnQyc7XG5cblx0XHRcdGlmIChzZlswXSA9PT0gc2ZbMF0udG9Mb3dlckNhc2UoKSkgbW9kZSA9IDFcblxuXHRcdFx0aWYgKF9zZmxlbiA+IDEpIHtcblx0XHRcdFx0c3dpdGNoIChzZi5jaGFyQXQoX3NmbGVuIC0gMSkpIHtcblx0XHRcdFx0XHRjYXNlICdtJzpcblx0XHRcdFx0XHRcdG1vZGUgPSAxO1xuXHRcdFx0XHRcdFx0bm90ZSA9IHNmLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRcdFx0bm90ZSA9IG5vdGUuY29uY2F0KHNmLnN1YnN0cmluZygxLCBfc2ZsZW4gLSAxKSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlICctJzpcblx0XHRcdFx0XHRcdG1vZGUgPSAxO1xuXHRcdFx0XHRcdFx0bm90ZSA9IHNmLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRcdFx0bm90ZSA9IG5vdGUuY29uY2F0KHNmLnN1YnN0cmluZygxLCBfc2ZsZW4gLSAxKSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlICdNJzpcblx0XHRcdFx0XHRcdG1vZGUgPSAwO1xuXHRcdFx0XHRcdFx0bm90ZSA9IHNmLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpO1xuXHRcdFx0XHRcdFx0bm90ZSA9IG5vdGUuY29uY2F0KHNmLnN1YnN0cmluZygxLCBfc2ZsZW4gLSAxKSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlICcrJzpcblx0XHRcdFx0XHRcdG1vZGUgPSAwO1xuXHRcdFx0XHRcdFx0bm90ZSA9IHNmLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpO1xuXHRcdFx0XHRcdFx0bm90ZSA9IG5vdGUuY29uY2F0KHNmLnN1YnN0cmluZygxLCBfc2ZsZW4gLSAxKSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR2YXIgZmlmdGhpbmRleCA9IGZpZnRoc1ttb2RlXS5pbmRleE9mKG5vdGUpO1xuXHRcdFx0c2YgPSBmaWZ0aGluZGV4ID09PSAtMSA/IDAgOiBmaWZ0aGluZGV4IC0gNztcblx0XHR9XG5cblx0XHRldmVudC5kYXRhID0gZXZlbnQuZGF0YS5jb25jYXQoVXRpbHMubnVtYmVyVG9CeXRlcyhzZiwgMSkpOyAvLyBOdW1iZXIgb2Ygc2hhcnAgb3IgZmxhdHMgKCA8IDAgZmxhdDsgPiAwIHNoYXJwKVxuXHRcdGV2ZW50LmRhdGEgPSBldmVudC5kYXRhLmNvbmNhdChVdGlscy5udW1iZXJUb0J5dGVzKG1vZGUsIDEpKTsgLy8gTW9kZTogMCBtYWpvciwgMSBtaW5vclxuXHRcdHJldHVybiB0aGlzLmFkZEV2ZW50KGV2ZW50KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBBZGRzIHRleHQgdG8gTUlESSBmaWxlLlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAtIFRleHQgdG8gYWRkLlxuXHQgKiBAcmV0dXJuIHtUcmFja31cblx0ICovXG5cdGFkZFRleHQodGV4dCkge1xuXHRcdHZhciBldmVudCA9IG5ldyBNZXRhRXZlbnQoe2RhdGE6IFtDb25zdGFudHMuTUVUQV9URVhUX0lEXX0pO1xuXHRcdHZhciBzdHJpbmdCeXRlcyA9IFV0aWxzLnN0cmluZ1RvQnl0ZXModGV4dCk7XG5cdFx0ZXZlbnQuZGF0YSA9IGV2ZW50LmRhdGEuY29uY2F0KFV0aWxzLm51bWJlclRvVmFyaWFibGVMZW5ndGgoc3RyaW5nQnl0ZXMubGVuZ3RoKSk7IC8vIFNpemVcblx0XHRldmVudC5kYXRhID0gZXZlbnQuZGF0YS5jb25jYXQoc3RyaW5nQnl0ZXMpOyAvLyBUZXh0XG5cdFx0cmV0dXJuIHRoaXMuYWRkRXZlbnQoZXZlbnQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEFkZHMgY29weXJpZ2h0IHRvIE1JREkgZmlsZS5cblx0ICogQHBhcmFtIHtzdHJpbmd9IHRleHQgLSBUZXh0IG9mIGNvcHlyaWdodCBsaW5lLlxuXHQgKiBAcmV0dXJuIHtUcmFja31cblx0ICovXG5cdGFkZENvcHlyaWdodCh0ZXh0KSB7XG5cdFx0dmFyIGV2ZW50ID0gbmV3IE1ldGFFdmVudCh7ZGF0YTogW0NvbnN0YW50cy5NRVRBX0NPUFlSSUdIVF9JRF19KTtcblx0XHR2YXIgc3RyaW5nQnl0ZXMgPSBVdGlscy5zdHJpbmdUb0J5dGVzKHRleHQpO1xuXHRcdGV2ZW50LmRhdGEgPSBldmVudC5kYXRhLmNvbmNhdChVdGlscy5udW1iZXJUb1ZhcmlhYmxlTGVuZ3RoKHN0cmluZ0J5dGVzLmxlbmd0aCkpOyAvLyBTaXplXG5cdFx0ZXZlbnQuZGF0YSA9IGV2ZW50LmRhdGEuY29uY2F0KHN0cmluZ0J5dGVzKTsgLy8gVGV4dFxuXHRcdHJldHVybiB0aGlzLmFkZEV2ZW50KGV2ZW50KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBBZGRzIFNlcXVlbmNlL1RyYWNrIE5hbWUuXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IC0gVGV4dCBvZiB0cmFjayBuYW1lLlxuXHQgKiBAcmV0dXJuIHtUcmFja31cblx0ICovXG5cdGFkZFRyYWNrTmFtZSh0ZXh0KSB7XG5cdFx0dmFyIGV2ZW50ID0gbmV3IE1ldGFFdmVudCh7ZGF0YTogW0NvbnN0YW50cy5NRVRBX1RSQUNLX05BTUVfSURdfSk7XG5cdFx0dmFyIHN0cmluZ0J5dGVzID0gVXRpbHMuc3RyaW5nVG9CeXRlcyh0ZXh0KTtcblx0XHRldmVudC5kYXRhID0gZXZlbnQuZGF0YS5jb25jYXQoVXRpbHMubnVtYmVyVG9WYXJpYWJsZUxlbmd0aChzdHJpbmdCeXRlcy5sZW5ndGgpKTsgLy8gU2l6ZVxuXHRcdGV2ZW50LmRhdGEgPSBldmVudC5kYXRhLmNvbmNhdChzdHJpbmdCeXRlcyk7IC8vIFRleHRcblx0XHRyZXR1cm4gdGhpcy5hZGRFdmVudChldmVudCk7XG5cdH1cblxuXHQvKipcblx0ICogU2V0cyBpbnN0cnVtZW50IG5hbWUgb2YgdHJhY2suXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IC0gTmFtZSBvZiBpbnN0cnVtZW50LlxuXHQgKiBAcmV0dXJuIHtUcmFja31cblx0ICovXG5cdGFkZEluc3RydW1lbnROYW1lKHRleHQpIHtcblx0XHR2YXIgZXZlbnQgPSBuZXcgTWV0YUV2ZW50KHtkYXRhOiBbQ29uc3RhbnRzLk1FVEFfSU5TVFJVTUVOVF9OQU1FX0lEXX0pO1xuXHRcdHZhciBzdHJpbmdCeXRlcyA9IFV0aWxzLnN0cmluZ1RvQnl0ZXModGV4dCk7XG5cdFx0ZXZlbnQuZGF0YSA9IGV2ZW50LmRhdGEuY29uY2F0KFV0aWxzLm51bWJlclRvVmFyaWFibGVMZW5ndGgoc3RyaW5nQnl0ZXMubGVuZ3RoKSk7IC8vIFNpemVcblx0XHRldmVudC5kYXRhID0gZXZlbnQuZGF0YS5jb25jYXQoc3RyaW5nQnl0ZXMpOyAvLyBUZXh0XG5cdFx0cmV0dXJuIHRoaXMuYWRkRXZlbnQoZXZlbnQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEFkZHMgbWFya2VyIHRvIE1JREkgZmlsZS5cblx0ICogQHBhcmFtIHtzdHJpbmd9IHRleHQgLSBNYXJrZXIgdGV4dC5cblx0ICogQHJldHVybiB7VHJhY2t9XG5cdCAqL1xuXHRhZGRNYXJrZXIodGV4dCkge1xuXHRcdHZhciBldmVudCA9IG5ldyBNZXRhRXZlbnQoe2RhdGE6IFtDb25zdGFudHMuTUVUQV9NQVJLRVJfSURdfSk7XG5cdFx0dmFyIHN0cmluZ0J5dGVzID0gVXRpbHMuc3RyaW5nVG9CeXRlcyh0ZXh0KTtcblx0XHRldmVudC5kYXRhID0gZXZlbnQuZGF0YS5jb25jYXQoVXRpbHMubnVtYmVyVG9WYXJpYWJsZUxlbmd0aChzdHJpbmdCeXRlcy5sZW5ndGgpKTsgLy8gU2l6ZVxuXHRcdGV2ZW50LmRhdGEgPSBldmVudC5kYXRhLmNvbmNhdChzdHJpbmdCeXRlcyk7IC8vIFRleHRcblx0XHRyZXR1cm4gdGhpcy5hZGRFdmVudChldmVudCk7XG5cdH1cblxuXHQvKipcblx0ICogQWRkcyBjdWUgcG9pbnQgdG8gTUlESSBmaWxlLlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAtIFRleHQgb2YgY3VlIHBvaW50LlxuXHQgKiBAcmV0dXJuIHtUcmFja31cblx0ICovXG5cdGFkZEN1ZVBvaW50KHRleHQpIHtcblx0XHR2YXIgZXZlbnQgPSBuZXcgTWV0YUV2ZW50KHtkYXRhOiBbQ29uc3RhbnRzLk1FVEFfQ1VFX1BPSU5UXX0pO1xuXHRcdHZhciBzdHJpbmdCeXRlcyA9IFV0aWxzLnN0cmluZ1RvQnl0ZXModGV4dCk7XG5cdFx0ZXZlbnQuZGF0YSA9IGV2ZW50LmRhdGEuY29uY2F0KFV0aWxzLm51bWJlclRvVmFyaWFibGVMZW5ndGgoc3RyaW5nQnl0ZXMubGVuZ3RoKSk7IC8vIFNpemVcblx0XHRldmVudC5kYXRhID0gZXZlbnQuZGF0YS5jb25jYXQoc3RyaW5nQnl0ZXMpOyAvLyBUZXh0XG5cdFx0cmV0dXJuIHRoaXMuYWRkRXZlbnQoZXZlbnQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEFkZHMgbHlyaWMgdG8gTUlESSBmaWxlLlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gbHlyaWMgLSBMeXJpYyB0ZXh0IHRvIGFkZC5cblx0ICogQHJldHVybiB7VHJhY2t9XG5cdCAqL1xuXHRhZGRMeXJpYyhseXJpYykge1xuXHRcdHZhciBldmVudCA9IG5ldyBNZXRhRXZlbnQoe2RhdGE6IFtDb25zdGFudHMuTUVUQV9MWVJJQ19JRF19KTtcblx0XHR2YXIgc3RyaW5nQnl0ZXMgPSBVdGlscy5zdHJpbmdUb0J5dGVzKGx5cmljKTtcblx0XHRldmVudC5kYXRhID0gZXZlbnQuZGF0YS5jb25jYXQoVXRpbHMubnVtYmVyVG9WYXJpYWJsZUxlbmd0aChzdHJpbmdCeXRlcy5sZW5ndGgpKTsgLy8gU2l6ZVxuXHRcdGV2ZW50LmRhdGEgPSBldmVudC5kYXRhLmNvbmNhdChzdHJpbmdCeXRlcyk7IC8vIEx5cmljXG5cdFx0cmV0dXJuIHRoaXMuYWRkRXZlbnQoZXZlbnQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENoYW5uZWwgbW9kZSBtZXNzYWdlc1xuXHQgKiBAcmV0dXJuIHtUcmFja31cblx0ICovXG5cdHBvbHlNb2RlT24oKSB7XG5cdFx0dmFyIGV2ZW50ID0gbmV3IE5vdGVPbkV2ZW50KHtkYXRhOiBbMHgwMCwgMHhCMCwgMHg3RSwgMHgwMF19KTtcblx0XHRyZXR1cm4gdGhpcy5hZGRFdmVudChldmVudCk7XG5cdH1cblxufVxuXG5leHBvcnQge1RyYWNrfTtcbiJdfQ==
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.Utils = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _tonalMidi = require('tonal-midi');

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * Static utility functions used throughout the library.
 */
var Utils = function () {
	function Utils() {
		_classCallCheck(this, Utils);
	}

	_createClass(Utils, null, [{
		key: 'version',


		/**
   * Gets MidiWriterJS version number.
   * @return {string}
   */
		value: function version() {
			return Constants.VERSION;
		}

		/**
   * Convert a string to an array of bytes
   * @param {string} string
   * @return {array}
   */

	}, {
		key: 'stringToBytes',
		value: function stringToBytes(string) {
			return string.split('').map(function (char) {
				return char.charCodeAt();
			});
		}

		/**
   * Checks if argument is a valid number.
   * @param {*} n - Value to check
   * @return {boolean}
   */

	}, {
		key: 'isNumeric',
		value: function isNumeric(n) {
			return !isNaN(parseFloat(n)) && isFinite(n);
		}

		/**
      * Returns the correct MIDI number for the specified pitch.
      * Uses Tonal Midi - https://github.com/danigb/tonal/tree/master/packages/midi
      * @param {(string|number)} pitch - 'C#4' or midi note code
      * @return {number}
      */

	}, {
		key: 'getPitch',
		value: function getPitch(pitch) {
			return (0, _tonalMidi.toMidi)(pitch);
		}

		/**
   * Translates number of ticks to MIDI timestamp format, returning an array of
   * hex strings with the time values. Midi has a very particular time to express time,
   * take a good look at the spec before ever touching this function.
   * Thanks to https://github.com/sergi/jsmidi
   *
   * @param {number} ticks - Number of ticks to be translated
   * @return {array} - Bytes that form the MIDI time value
   */

	}, {
		key: 'numberToVariableLength',
		value: function numberToVariableLength(ticks) {
			var buffer = ticks & 0x7F;

			while (ticks = ticks >> 7) {
				buffer <<= 8;
				buffer |= ticks & 0x7F | 0x80;
			}

			var bList = [];
			while (true) {
				bList.push(buffer & 0xff);

				if (buffer & 0x80) buffer >>= 8;else {
					break;
				}
			}

			return bList;
		}

		/**
   * Counts number of bytes in string
   * @param {string} s
   * @return {array}
   */

	}, {
		key: 'stringByteCount',
		value: function stringByteCount(s) {
			return encodeURI(s).split(/%..|./).length - 1;
		}

		/**
   * Get an int from an array of bytes.
   * @param {array} bytes
   * @return {number}
   */

	}, {
		key: 'numberFromBytes',
		value: function numberFromBytes(bytes) {
			var hex = '';
			var stringResult;

			bytes.forEach(function (byte) {
				stringResult = byte.toString(16);

				// ensure string is 2 chars
				if (stringResult.length == 1) stringResult = "0" + stringResult;

				hex += stringResult;
			});

			return parseInt(hex, 16);
		}

		/**
   * Takes a number and splits it up into an array of bytes.  Can be padded by passing a number to bytesNeeded
   * @param {number} number
   * @param {number} bytesNeeded
   * @return {array} - Array of bytes
   */

	}, {
		key: 'numberToBytes',
		value: function numberToBytes(number, bytesNeeded) {
			bytesNeeded = bytesNeeded || 1;

			var hexString = number.toString(16);

			if (hexString.length & 1) {
				// Make sure hex string is even number of chars
				hexString = '0' + hexString;
			}

			// Split hex string into an array of two char elements
			var hexArray = hexString.match(/.{2}/g);

			// Now parse them out as integers
			hexArray = hexArray.map(function (item) {
				return parseInt(item, 16);
			});

			// Prepend empty bytes if we don't have enough
			if (hexArray.length < bytesNeeded) {
				while (bytesNeeded - hexArray.length > 0) {
					hexArray.unshift(0);
				}
			}

			return hexArray;
		}
	}]);

	return Utils;
}();

exports.Utils = Utils;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlscy5qcyJdLCJuYW1lcyI6WyJVdGlscyIsIkNvbnN0YW50cyIsIlZFUlNJT04iLCJzdHJpbmciLCJzcGxpdCIsIm1hcCIsImNoYXIiLCJjaGFyQ29kZUF0IiwibiIsImlzTmFOIiwicGFyc2VGbG9hdCIsImlzRmluaXRlIiwicGl0Y2giLCJ0aWNrcyIsImJ1ZmZlciIsImJMaXN0IiwicHVzaCIsInMiLCJlbmNvZGVVUkkiLCJsZW5ndGgiLCJieXRlcyIsImhleCIsInN0cmluZ1Jlc3VsdCIsImZvckVhY2giLCJieXRlIiwidG9TdHJpbmciLCJwYXJzZUludCIsIm51bWJlciIsImJ5dGVzTmVlZGVkIiwiaGV4U3RyaW5nIiwiaGV4QXJyYXkiLCJtYXRjaCIsIml0ZW0iLCJ1bnNoaWZ0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7OztBQUVBOzs7SUFHTUEsSzs7Ozs7Ozs7O0FBRUw7Ozs7NEJBSWlCO0FBQ2hCLFVBQU9DLFVBQVVDLE9BQWpCO0FBQ0E7O0FBRUQ7Ozs7Ozs7O2dDQUtxQkMsTSxFQUFRO0FBQzVCLFVBQU9BLE9BQU9DLEtBQVAsQ0FBYSxFQUFiLEVBQWlCQyxHQUFqQixDQUFxQjtBQUFBLFdBQVFDLEtBQUtDLFVBQUwsRUFBUjtBQUFBLElBQXJCLENBQVA7QUFDQTs7QUFFRDs7Ozs7Ozs7NEJBS2lCQyxDLEVBQUc7QUFDbkIsVUFBTyxDQUFDQyxNQUFNQyxXQUFXRixDQUFYLENBQU4sQ0FBRCxJQUF5QkcsU0FBU0gsQ0FBVCxDQUFoQztBQUNBOztBQUVEOzs7Ozs7Ozs7MkJBTW9CSSxLLEVBQU87QUFDdEIsVUFBTyx1QkFBT0EsS0FBUCxDQUFQO0FBQ0E7O0FBRUw7Ozs7Ozs7Ozs7Ozt5Q0FTOEJDLEssRUFBTztBQUNqQyxPQUFJQyxTQUFTRCxRQUFRLElBQXJCOztBQUVBLFVBQU9BLFFBQVFBLFNBQVMsQ0FBeEIsRUFBMkI7QUFDdkJDLGVBQVcsQ0FBWDtBQUNBQSxjQUFZRCxRQUFRLElBQVQsR0FBaUIsSUFBNUI7QUFDSDs7QUFFRCxPQUFJRSxRQUFRLEVBQVo7QUFDQSxVQUFPLElBQVAsRUFBYTtBQUNUQSxVQUFNQyxJQUFOLENBQVdGLFNBQVMsSUFBcEI7O0FBRUEsUUFBSUEsU0FBUyxJQUFiLEVBQW1CQSxXQUFXLENBQVgsQ0FBbkIsS0FDSztBQUFFO0FBQVE7QUFDbEI7O0FBRUQsVUFBT0MsS0FBUDtBQUNIOztBQUVEOzs7Ozs7OztrQ0FLdUJFLEMsRUFBRztBQUN6QixVQUFPQyxVQUFVRCxDQUFWLEVBQWFiLEtBQWIsQ0FBbUIsT0FBbkIsRUFBNEJlLE1BQTVCLEdBQXFDLENBQTVDO0FBQ0E7O0FBRUQ7Ozs7Ozs7O2tDQUt1QkMsSyxFQUFPO0FBQzdCLE9BQUlDLE1BQU0sRUFBVjtBQUNBLE9BQUlDLFlBQUo7O0FBRUFGLFNBQU1HLE9BQU4sQ0FBYyxVQUFTQyxJQUFULEVBQWU7QUFDNUJGLG1CQUFlRSxLQUFLQyxRQUFMLENBQWMsRUFBZCxDQUFmOztBQUVBO0FBQ0EsUUFBSUgsYUFBYUgsTUFBYixJQUF1QixDQUEzQixFQUE4QkcsZUFBZSxNQUFNQSxZQUFyQjs7QUFFOUJELFdBQU9DLFlBQVA7QUFDQSxJQVBEOztBQVNBLFVBQU9JLFNBQVNMLEdBQVQsRUFBYyxFQUFkLENBQVA7QUFDQTs7QUFFRDs7Ozs7Ozs7O2dDQU1xQk0sTSxFQUFRQyxXLEVBQWE7QUFDekNBLGlCQUFjQSxlQUFlLENBQTdCOztBQUVBLE9BQUlDLFlBQVlGLE9BQU9GLFFBQVAsQ0FBZ0IsRUFBaEIsQ0FBaEI7O0FBRUEsT0FBSUksVUFBVVYsTUFBVixHQUFtQixDQUF2QixFQUEwQjtBQUFFO0FBQzNCVSxnQkFBWSxNQUFNQSxTQUFsQjtBQUNBOztBQUVEO0FBQ0EsT0FBSUMsV0FBV0QsVUFBVUUsS0FBVixDQUFnQixPQUFoQixDQUFmOztBQUVBO0FBQ0FELGNBQVdBLFNBQVN6QixHQUFULENBQWE7QUFBQSxXQUFRcUIsU0FBU00sSUFBVCxFQUFlLEVBQWYsQ0FBUjtBQUFBLElBQWIsQ0FBWDs7QUFFQTtBQUNBLE9BQUlGLFNBQVNYLE1BQVQsR0FBa0JTLFdBQXRCLEVBQW1DO0FBQ2xDLFdBQU9BLGNBQWNFLFNBQVNYLE1BQXZCLEdBQWdDLENBQXZDLEVBQTBDO0FBQ3pDVyxjQUFTRyxPQUFULENBQWlCLENBQWpCO0FBQ0E7QUFDRDs7QUFFRCxVQUFPSCxRQUFQO0FBQ0E7Ozs7OztRQUdNOUIsSyxHQUFBQSxLIiwiZmlsZSI6InV0aWxzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHt0b01pZGl9IGZyb20gJ3RvbmFsLW1pZGknO1xuXG4vKipcbiAqIFN0YXRpYyB1dGlsaXR5IGZ1bmN0aW9ucyB1c2VkIHRocm91Z2hvdXQgdGhlIGxpYnJhcnkuXG4gKi9cbmNsYXNzIFV0aWxzIHtcblxuXHQvKipcblx0ICogR2V0cyBNaWRpV3JpdGVySlMgdmVyc2lvbiBudW1iZXIuXG5cdCAqIEByZXR1cm4ge3N0cmluZ31cblx0ICovXG5cdHN0YXRpYyB2ZXJzaW9uKCkge1xuXHRcdHJldHVybiBDb25zdGFudHMuVkVSU0lPTjtcblx0fVxuXG5cdC8qKlxuXHQgKiBDb252ZXJ0IGEgc3RyaW5nIHRvIGFuIGFycmF5IG9mIGJ5dGVzXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmdcblx0ICogQHJldHVybiB7YXJyYXl9XG5cdCAqL1xuXHRzdGF0aWMgc3RyaW5nVG9CeXRlcyhzdHJpbmcpIHtcblx0XHRyZXR1cm4gc3RyaW5nLnNwbGl0KCcnKS5tYXAoY2hhciA9PiBjaGFyLmNoYXJDb2RlQXQoKSlcblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVja3MgaWYgYXJndW1lbnQgaXMgYSB2YWxpZCBudW1iZXIuXG5cdCAqIEBwYXJhbSB7Kn0gbiAtIFZhbHVlIHRvIGNoZWNrXG5cdCAqIEByZXR1cm4ge2Jvb2xlYW59XG5cdCAqL1xuXHRzdGF0aWMgaXNOdW1lcmljKG4pIHtcblx0XHRyZXR1cm4gIWlzTmFOKHBhcnNlRmxvYXQobikpICYmIGlzRmluaXRlKG4pXG5cdH1cblxuXHQvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBjb3JyZWN0IE1JREkgbnVtYmVyIGZvciB0aGUgc3BlY2lmaWVkIHBpdGNoLlxuICAgICAqIFVzZXMgVG9uYWwgTWlkaSAtIGh0dHBzOi8vZ2l0aHViLmNvbS9kYW5pZ2IvdG9uYWwvdHJlZS9tYXN0ZXIvcGFja2FnZXMvbWlkaVxuICAgICAqIEBwYXJhbSB7KHN0cmluZ3xudW1iZXIpfSBwaXRjaCAtICdDIzQnIG9yIG1pZGkgbm90ZSBjb2RlXG4gICAgICogQHJldHVybiB7bnVtYmVyfVxuICAgICAqL1xuICAgICBzdGF0aWMgZ2V0UGl0Y2gocGl0Y2gpIHtcbiAgICAgXHRyZXR1cm4gdG9NaWRpKHBpdGNoKTtcbiAgICAgfVxuXG5cdC8qKlxuXHQgKiBUcmFuc2xhdGVzIG51bWJlciBvZiB0aWNrcyB0byBNSURJIHRpbWVzdGFtcCBmb3JtYXQsIHJldHVybmluZyBhbiBhcnJheSBvZlxuXHQgKiBoZXggc3RyaW5ncyB3aXRoIHRoZSB0aW1lIHZhbHVlcy4gTWlkaSBoYXMgYSB2ZXJ5IHBhcnRpY3VsYXIgdGltZSB0byBleHByZXNzIHRpbWUsXG5cdCAqIHRha2UgYSBnb29kIGxvb2sgYXQgdGhlIHNwZWMgYmVmb3JlIGV2ZXIgdG91Y2hpbmcgdGhpcyBmdW5jdGlvbi5cblx0ICogVGhhbmtzIHRvIGh0dHBzOi8vZ2l0aHViLmNvbS9zZXJnaS9qc21pZGlcblx0ICpcblx0ICogQHBhcmFtIHtudW1iZXJ9IHRpY2tzIC0gTnVtYmVyIG9mIHRpY2tzIHRvIGJlIHRyYW5zbGF0ZWRcblx0ICogQHJldHVybiB7YXJyYXl9IC0gQnl0ZXMgdGhhdCBmb3JtIHRoZSBNSURJIHRpbWUgdmFsdWVcblx0ICovXG5cdHN0YXRpYyBudW1iZXJUb1ZhcmlhYmxlTGVuZ3RoKHRpY2tzKSB7XG5cdCAgICB2YXIgYnVmZmVyID0gdGlja3MgJiAweDdGO1xuXG5cdCAgICB3aGlsZSAodGlja3MgPSB0aWNrcyA+PiA3KSB7XG5cdCAgICAgICAgYnVmZmVyIDw8PSA4O1xuXHQgICAgICAgIGJ1ZmZlciB8PSAoKHRpY2tzICYgMHg3RikgfCAweDgwKTtcblx0ICAgIH1cblxuXHQgICAgdmFyIGJMaXN0ID0gW107XG5cdCAgICB3aGlsZSAodHJ1ZSkge1xuXHQgICAgICAgIGJMaXN0LnB1c2goYnVmZmVyICYgMHhmZik7XG5cblx0ICAgICAgICBpZiAoYnVmZmVyICYgMHg4MCkgYnVmZmVyID4+PSA4XG5cdCAgICAgICAgZWxzZSB7IGJyZWFrOyB9XG5cdCAgICB9XG5cblx0ICAgIHJldHVybiBiTGlzdDtcblx0fVxuXG5cdC8qKlxuXHQgKiBDb3VudHMgbnVtYmVyIG9mIGJ5dGVzIGluIHN0cmluZ1xuXHQgKiBAcGFyYW0ge3N0cmluZ30gc1xuXHQgKiBAcmV0dXJuIHthcnJheX1cblx0ICovXG5cdHN0YXRpYyBzdHJpbmdCeXRlQ291bnQocykge1xuXHRcdHJldHVybiBlbmNvZGVVUkkocykuc3BsaXQoLyUuLnwuLykubGVuZ3RoIC0gMVxuXHR9XG5cblx0LyoqXG5cdCAqIEdldCBhbiBpbnQgZnJvbSBhbiBhcnJheSBvZiBieXRlcy5cblx0ICogQHBhcmFtIHthcnJheX0gYnl0ZXNcblx0ICogQHJldHVybiB7bnVtYmVyfVxuXHQgKi9cblx0c3RhdGljIG51bWJlckZyb21CeXRlcyhieXRlcykge1xuXHRcdHZhciBoZXggPSAnJztcblx0XHR2YXIgc3RyaW5nUmVzdWx0O1xuXG5cdFx0Ynl0ZXMuZm9yRWFjaChmdW5jdGlvbihieXRlKSB7XG5cdFx0XHRzdHJpbmdSZXN1bHQgPSBieXRlLnRvU3RyaW5nKDE2KTtcblxuXHRcdFx0Ly8gZW5zdXJlIHN0cmluZyBpcyAyIGNoYXJzXG5cdFx0XHRpZiAoc3RyaW5nUmVzdWx0Lmxlbmd0aCA9PSAxKSBzdHJpbmdSZXN1bHQgPSBcIjBcIiArIHN0cmluZ1Jlc3VsdFxuXG5cdFx0XHRoZXggKz0gc3RyaW5nUmVzdWx0O1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHBhcnNlSW50KGhleCwgMTYpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFRha2VzIGEgbnVtYmVyIGFuZCBzcGxpdHMgaXQgdXAgaW50byBhbiBhcnJheSBvZiBieXRlcy4gIENhbiBiZSBwYWRkZWQgYnkgcGFzc2luZyBhIG51bWJlciB0byBieXRlc05lZWRlZFxuXHQgKiBAcGFyYW0ge251bWJlcn0gbnVtYmVyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBieXRlc05lZWRlZFxuXHQgKiBAcmV0dXJuIHthcnJheX0gLSBBcnJheSBvZiBieXRlc1xuXHQgKi9cblx0c3RhdGljIG51bWJlclRvQnl0ZXMobnVtYmVyLCBieXRlc05lZWRlZCkge1xuXHRcdGJ5dGVzTmVlZGVkID0gYnl0ZXNOZWVkZWQgfHwgMTtcblxuXHRcdHZhciBoZXhTdHJpbmcgPSBudW1iZXIudG9TdHJpbmcoMTYpO1xuXG5cdFx0aWYgKGhleFN0cmluZy5sZW5ndGggJiAxKSB7IC8vIE1ha2Ugc3VyZSBoZXggc3RyaW5nIGlzIGV2ZW4gbnVtYmVyIG9mIGNoYXJzXG5cdFx0XHRoZXhTdHJpbmcgPSAnMCcgKyBoZXhTdHJpbmc7XG5cdFx0fVxuXG5cdFx0Ly8gU3BsaXQgaGV4IHN0cmluZyBpbnRvIGFuIGFycmF5IG9mIHR3byBjaGFyIGVsZW1lbnRzXG5cdFx0dmFyIGhleEFycmF5ID0gaGV4U3RyaW5nLm1hdGNoKC8uezJ9L2cpO1xuXG5cdFx0Ly8gTm93IHBhcnNlIHRoZW0gb3V0IGFzIGludGVnZXJzXG5cdFx0aGV4QXJyYXkgPSBoZXhBcnJheS5tYXAoaXRlbSA9PiBwYXJzZUludChpdGVtLCAxNikpXG5cblx0XHQvLyBQcmVwZW5kIGVtcHR5IGJ5dGVzIGlmIHdlIGRvbid0IGhhdmUgZW5vdWdoXG5cdFx0aWYgKGhleEFycmF5Lmxlbmd0aCA8IGJ5dGVzTmVlZGVkKSB7XG5cdFx0XHR3aGlsZSAoYnl0ZXNOZWVkZWQgLSBoZXhBcnJheS5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdGhleEFycmF5LnVuc2hpZnQoMCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGhleEFycmF5O1xuXHR9XG59XG5cbmV4cG9ydCB7VXRpbHN9O1xuIl19
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var VexFlow = function () {
	function VexFlow() {
		_classCallCheck(this, VexFlow);
	}
	// code...


	/**
  * Support for converting VexFlow voice into MidiWriterJS track
  * @return MidiWritier.Track object
  */


	_createClass(VexFlow, [{
		key: 'trackFromVoice',
		value: function trackFromVoice(voice) {
			var track = new Track();
			var wait;
			var pitches = [];

			voice.tickables.forEach(function (tickable, i) {
				pitches = [];

				if (tickable.noteType === 'n') {
					notes[i].keys.forEach(function (key) {
						// build array of pitches
						pitches.push(this.convertPitch(key));
					});
				} else if (tickable.noteType === 'r') {
					// move on to the next tickable and use this rest as a `wait` property for the next event
					wait = this.convertDuration(tickable);
					return;
				}

				track.addEvent(new NoteEvent({ pitch: pitches, duration: this.convertDuration(voice.tickables[i]), wait: wait }));

				// reset wait
				wait = 0;
			});

			return track;
		}

		/**
   * Converts VexFlow pitch syntax to MidiWriterJS syntax
   * @param pitch string
   */

	}, {
		key: 'convertPitch',
		value: function convertPitch(pitch) {
			return pitch.replace('/', '');
		}

		/**
   * Converts VexFlow duration syntax to MidiWriterJS syntax
   * @param note struct from VexFlow
   */

	}, {
		key: 'convertDuration',
		value: function convertDuration(note) {
			switch (note.duration) {
				case 'w':
					return '1';
				case 'h':
					return note.isDotted() ? 'd2' : '2';
				case 'q':
					return note.isDotted() ? 'd4' : '4';
				case '8':
					return note.isDotted() ? 'd8' : '8';
			}

			return note.duration;
		}
	}]);

	return VexFlow;
}();

exports.VexFlow = VexFlow;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy92ZXhmbG93LmpzIl0sIm5hbWVzIjpbIlZleEZsb3ciLCJ2b2ljZSIsInRyYWNrIiwiVHJhY2siLCJ3YWl0IiwicGl0Y2hlcyIsInRpY2thYmxlcyIsImZvckVhY2giLCJ0aWNrYWJsZSIsImkiLCJub3RlVHlwZSIsIm5vdGVzIiwia2V5cyIsImtleSIsInB1c2giLCJjb252ZXJ0UGl0Y2giLCJjb252ZXJ0RHVyYXRpb24iLCJhZGRFdmVudCIsIk5vdGVFdmVudCIsInBpdGNoIiwiZHVyYXRpb24iLCJyZXBsYWNlIiwibm90ZSIsImlzRG90dGVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0lBQU1BLE87QUFFTCxvQkFBYztBQUFBO0FBRWI7QUFEQTs7O0FBR0Q7Ozs7Ozs7O2lDQUllQyxLLEVBQU87QUFDckIsT0FBSUMsUUFBUSxJQUFJQyxLQUFKLEVBQVo7QUFDQSxPQUFJQyxJQUFKO0FBQ0EsT0FBSUMsVUFBVSxFQUFkOztBQUVBSixTQUFNSyxTQUFOLENBQWdCQyxPQUFoQixDQUF3QixVQUFTQyxRQUFULEVBQW1CQyxDQUFuQixFQUFzQjtBQUM3Q0osY0FBVSxFQUFWOztBQUVBLFFBQUlHLFNBQVNFLFFBQVQsS0FBc0IsR0FBMUIsRUFBK0I7QUFDOUJDLFdBQU1GLENBQU4sRUFBU0csSUFBVCxDQUFjTCxPQUFkLENBQXNCLFVBQVNNLEdBQVQsRUFBYztBQUNuQztBQUNBUixjQUFRUyxJQUFSLENBQWEsS0FBS0MsWUFBTCxDQUFrQkYsR0FBbEIsQ0FBYjtBQUNBLE1BSEQ7QUFLQSxLQU5ELE1BTU8sSUFBSUwsU0FBU0UsUUFBVCxLQUFzQixHQUExQixFQUErQjtBQUNyQztBQUNBTixZQUFPLEtBQUtZLGVBQUwsQ0FBcUJSLFFBQXJCLENBQVA7QUFDQTtBQUNBOztBQUVETixVQUFNZSxRQUFOLENBQWUsSUFBSUMsU0FBSixDQUFjLEVBQUNDLE9BQU9kLE9BQVIsRUFBaUJlLFVBQVUsS0FBS0osZUFBTCxDQUFxQmYsTUFBTUssU0FBTixDQUFnQkcsQ0FBaEIsQ0FBckIsQ0FBM0IsRUFBcUVMLE1BQU1BLElBQTNFLEVBQWQsQ0FBZjs7QUFFQTtBQUNBQSxXQUFPLENBQVA7QUFDQSxJQW5CRDs7QUFxQkEsVUFBT0YsS0FBUDtBQUNBOztBQUdEOzs7Ozs7OytCQUlhaUIsSyxFQUFPO0FBQ25CLFVBQU9BLE1BQU1FLE9BQU4sQ0FBYyxHQUFkLEVBQW1CLEVBQW5CLENBQVA7QUFDQTs7QUFHRDs7Ozs7OztrQ0FJZ0JDLEksRUFBTTtBQUNyQixXQUFRQSxLQUFLRixRQUFiO0FBQ0MsU0FBSyxHQUFMO0FBQ0MsWUFBTyxHQUFQO0FBQ0QsU0FBSyxHQUFMO0FBQ0MsWUFBT0UsS0FBS0MsUUFBTCxLQUFrQixJQUFsQixHQUF5QixHQUFoQztBQUNELFNBQUssR0FBTDtBQUNDLFlBQU9ELEtBQUtDLFFBQUwsS0FBa0IsSUFBbEIsR0FBeUIsR0FBaEM7QUFDRCxTQUFLLEdBQUw7QUFDQyxZQUFPRCxLQUFLQyxRQUFMLEtBQWtCLElBQWxCLEdBQXlCLEdBQWhDO0FBUkY7O0FBV0EsVUFBT0QsS0FBS0YsUUFBWjtBQUNBOzs7Ozs7UUFHTXBCLE8sR0FBQUEsTyIsImZpbGUiOiJ2ZXhmbG93LmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgVmV4RmxvdyB7XG5cdFxuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHQvLyBjb2RlLi4uXG5cdH1cblxuXHQvKipcblx0ICogU3VwcG9ydCBmb3IgY29udmVydGluZyBWZXhGbG93IHZvaWNlIGludG8gTWlkaVdyaXRlckpTIHRyYWNrXG5cdCAqIEByZXR1cm4gTWlkaVdyaXRpZXIuVHJhY2sgb2JqZWN0XG5cdCAqL1xuXHR0cmFja0Zyb21Wb2ljZSh2b2ljZSkge1xuXHRcdHZhciB0cmFjayA9IG5ldyBUcmFjaygpO1xuXHRcdHZhciB3YWl0O1xuXHRcdHZhciBwaXRjaGVzID0gW107XG5cblx0XHR2b2ljZS50aWNrYWJsZXMuZm9yRWFjaChmdW5jdGlvbih0aWNrYWJsZSwgaSkge1xuXHRcdFx0cGl0Y2hlcyA9IFtdO1xuXG5cdFx0XHRpZiAodGlja2FibGUubm90ZVR5cGUgPT09ICduJykge1xuXHRcdFx0XHRub3Rlc1tpXS5rZXlzLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG5cdFx0XHRcdFx0Ly8gYnVpbGQgYXJyYXkgb2YgcGl0Y2hlc1xuXHRcdFx0XHRcdHBpdGNoZXMucHVzaCh0aGlzLmNvbnZlcnRQaXRjaChrZXkpKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdH0gZWxzZSBpZiAodGlja2FibGUubm90ZVR5cGUgPT09ICdyJykge1xuXHRcdFx0XHQvLyBtb3ZlIG9uIHRvIHRoZSBuZXh0IHRpY2thYmxlIGFuZCB1c2UgdGhpcyByZXN0IGFzIGEgYHdhaXRgIHByb3BlcnR5IGZvciB0aGUgbmV4dCBldmVudFxuXHRcdFx0XHR3YWl0ID0gdGhpcy5jb252ZXJ0RHVyYXRpb24odGlja2FibGUpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHRyYWNrLmFkZEV2ZW50KG5ldyBOb3RlRXZlbnQoe3BpdGNoOiBwaXRjaGVzLCBkdXJhdGlvbjogdGhpcy5jb252ZXJ0RHVyYXRpb24odm9pY2UudGlja2FibGVzW2ldKSwgd2FpdDogd2FpdH0pKTtcblx0XHRcdFxuXHRcdFx0Ly8gcmVzZXQgd2FpdFxuXHRcdFx0d2FpdCA9IDA7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gdHJhY2s7XG5cdH1cblxuXG5cdC8qKlxuXHQgKiBDb252ZXJ0cyBWZXhGbG93IHBpdGNoIHN5bnRheCB0byBNaWRpV3JpdGVySlMgc3ludGF4XG5cdCAqIEBwYXJhbSBwaXRjaCBzdHJpbmdcblx0ICovXG5cdGNvbnZlcnRQaXRjaChwaXRjaCkge1xuXHRcdHJldHVybiBwaXRjaC5yZXBsYWNlKCcvJywgJycpO1xuXHR9IFxuXG5cblx0LyoqXG5cdCAqIENvbnZlcnRzIFZleEZsb3cgZHVyYXRpb24gc3ludGF4IHRvIE1pZGlXcml0ZXJKUyBzeW50YXhcblx0ICogQHBhcmFtIG5vdGUgc3RydWN0IGZyb20gVmV4Rmxvd1xuXHQgKi9cblx0Y29udmVydER1cmF0aW9uKG5vdGUpIHtcblx0XHRzd2l0Y2ggKG5vdGUuZHVyYXRpb24pIHtcblx0XHRcdGNhc2UgJ3cnOlxuXHRcdFx0XHRyZXR1cm4gJzEnO1xuXHRcdFx0Y2FzZSAnaCc6XG5cdFx0XHRcdHJldHVybiBub3RlLmlzRG90dGVkKCkgPyAnZDInIDogJzInO1xuXHRcdFx0Y2FzZSAncSc6XG5cdFx0XHRcdHJldHVybiBub3RlLmlzRG90dGVkKCkgPyAnZDQnIDogJzQnO1xuXHRcdFx0Y2FzZSAnOCc6XG5cdFx0XHRcdHJldHVybiBub3RlLmlzRG90dGVkKCkgPyAnZDgnIDogJzgnO1xuXHRcdH1cblxuXHRcdHJldHVybiBub3RlLmR1cmF0aW9uO1xuXHR9O1xufVxuXG5leHBvcnQge1ZleEZsb3d9O1xuIl19
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * Object that puts together tracks and provides methods for file output.
 * @param {array} tracks - An array of {Track} objects.
 * @return {Writer}
 */
var Writer = function () {
	function Writer(tracks) {
		_classCallCheck(this, Writer);

		this.data = [];

		var trackType = tracks.length > 1 ? Constants.HEADER_CHUNK_FORMAT1 : Constants.HEADER_CHUNK_FORMAT0;
		var numberOfTracks = Utils.numberToBytes(tracks.length, 2); // two bytes long

		// Header chunk
		this.data.push(new Chunk({
			type: Constants.HEADER_CHUNK_TYPE,
			data: trackType.concat(numberOfTracks, Constants.HEADER_CHUNK_DIVISION) }));

		// Track chunks
		tracks.forEach(function (track, i) {
			track.addEvent(new MetaEvent({ data: Constants.META_END_OF_TRACK_ID }));
			this.data.push(track);
		}, this);
	}

	/**
  * Builds the file into a Uint8Array
  * @return {Uint8Array}
  */


	_createClass(Writer, [{
		key: 'buildFile',
		value: function buildFile() {
			var build = [];

			// Data consists of chunks which consists of data
			this.data.forEach(function (d) {
				return build = build.concat(d.type, d.size, d.data);
			});

			return new Uint8Array(build);
		}

		/**
   * Convert file buffer to a base64 string.  Different methods depending on if browser or node.
   * @return {string}
   */

	}, {
		key: 'base64',
		value: function base64() {
			if (typeof btoa === 'function') return btoa(String.fromCharCode.apply(null, this.buildFile()));
			return new Buffer(this.buildFile()).toString('base64');
		}

		/**
   * Get the data URI.
   * @return {string}
   */

	}, {
		key: 'dataUri',
		value: function dataUri() {
			return 'data:audio/midi;base64,' + this.base64();
		}

		/**
   * Output to stdout
   * @return {string}
   */

	}, {
		key: 'stdout',
		value: function stdout() {
			return process.stdout.write(new Buffer(this.buildFile()));
		}

		/**
   * Save to MIDI file
   * @param {string} filename
   */

	}, {
		key: 'saveMIDI',
		value: function saveMIDI(filename) {
			var buffer = new Buffer(this.buildFile());
			fs.writeFile(filename + '.mid', buffer, function (err) {
				if (err) return console.log(err);
			});
		}
	}]);

	return Writer;
}();

exports.Writer = Writer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy93cml0ZXIuanMiXSwibmFtZXMiOlsiV3JpdGVyIiwidHJhY2tzIiwiZGF0YSIsInRyYWNrVHlwZSIsImxlbmd0aCIsIkNvbnN0YW50cyIsIkhFQURFUl9DSFVOS19GT1JNQVQxIiwiSEVBREVSX0NIVU5LX0ZPUk1BVDAiLCJudW1iZXJPZlRyYWNrcyIsIlV0aWxzIiwibnVtYmVyVG9CeXRlcyIsInB1c2giLCJDaHVuayIsInR5cGUiLCJIRUFERVJfQ0hVTktfVFlQRSIsImNvbmNhdCIsIkhFQURFUl9DSFVOS19ESVZJU0lPTiIsImZvckVhY2giLCJ0cmFjayIsImkiLCJhZGRFdmVudCIsIk1ldGFFdmVudCIsIk1FVEFfRU5EX09GX1RSQUNLX0lEIiwiYnVpbGQiLCJkIiwic2l6ZSIsIlVpbnQ4QXJyYXkiLCJidG9hIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwiYXBwbHkiLCJidWlsZEZpbGUiLCJCdWZmZXIiLCJ0b1N0cmluZyIsImJhc2U2NCIsInByb2Nlc3MiLCJzdGRvdXQiLCJ3cml0ZSIsImZpbGVuYW1lIiwiYnVmZmVyIiwiZnMiLCJ3cml0ZUZpbGUiLCJlcnIiLCJjb25zb2xlIiwibG9nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7Ozs7O0lBS01BLE07QUFDTCxpQkFBWUMsTUFBWixFQUFvQjtBQUFBOztBQUNuQixPQUFLQyxJQUFMLEdBQVksRUFBWjs7QUFFQSxNQUFJQyxZQUFZRixPQUFPRyxNQUFQLEdBQWdCLENBQWhCLEdBQW9CQyxVQUFVQyxvQkFBOUIsR0FBcURELFVBQVVFLG9CQUEvRTtBQUNBLE1BQUlDLGlCQUFpQkMsTUFBTUMsYUFBTixDQUFvQlQsT0FBT0csTUFBM0IsRUFBbUMsQ0FBbkMsQ0FBckIsQ0FKbUIsQ0FJeUM7O0FBRTVEO0FBQ0EsT0FBS0YsSUFBTCxDQUFVUyxJQUFWLENBQWUsSUFBSUMsS0FBSixDQUFVO0FBQ25CQyxTQUFNUixVQUFVUyxpQkFERztBQUVuQlosU0FBTUMsVUFBVVksTUFBVixDQUFpQlAsY0FBakIsRUFBaUNILFVBQVVXLHFCQUEzQyxDQUZhLEVBQVYsQ0FBZjs7QUFJQTtBQUNBZixTQUFPZ0IsT0FBUCxDQUFlLFVBQVNDLEtBQVQsRUFBZ0JDLENBQWhCLEVBQW1CO0FBQ2pDRCxTQUFNRSxRQUFOLENBQWUsSUFBSUMsU0FBSixDQUFjLEVBQUNuQixNQUFNRyxVQUFVaUIsb0JBQWpCLEVBQWQsQ0FBZjtBQUNBLFFBQUtwQixJQUFMLENBQVVTLElBQVYsQ0FBZU8sS0FBZjtBQUNBLEdBSEQsRUFHRyxJQUhIO0FBSUE7O0FBRUQ7Ozs7Ozs7OzhCQUlZO0FBQ1gsT0FBSUssUUFBUSxFQUFaOztBQUVBO0FBQ0EsUUFBS3JCLElBQUwsQ0FBVWUsT0FBVixDQUFrQixVQUFDTyxDQUFEO0FBQUEsV0FBT0QsUUFBUUEsTUFBTVIsTUFBTixDQUFhUyxFQUFFWCxJQUFmLEVBQXFCVyxFQUFFQyxJQUF2QixFQUE2QkQsRUFBRXRCLElBQS9CLENBQWY7QUFBQSxJQUFsQjs7QUFFQSxVQUFPLElBQUl3QixVQUFKLENBQWVILEtBQWYsQ0FBUDtBQUNBOztBQUVEOzs7Ozs7OzJCQUlTO0FBQ1IsT0FBSSxPQUFPSSxJQUFQLEtBQWdCLFVBQXBCLEVBQWdDLE9BQU9BLEtBQUtDLE9BQU9DLFlBQVAsQ0FBb0JDLEtBQXBCLENBQTBCLElBQTFCLEVBQWdDLEtBQUtDLFNBQUwsRUFBaEMsQ0FBTCxDQUFQO0FBQ2hDLFVBQU8sSUFBSUMsTUFBSixDQUFXLEtBQUtELFNBQUwsRUFBWCxFQUE2QkUsUUFBN0IsQ0FBc0MsUUFBdEMsQ0FBUDtBQUNBOztBQUVFOzs7Ozs7OzRCQUlVO0FBQ1QsVUFBTyw0QkFBNEIsS0FBS0MsTUFBTCxFQUFuQztBQUNBOztBQUVKOzs7Ozs7OzJCQUlZO0FBQ1IsVUFBT0MsUUFBUUMsTUFBUixDQUFlQyxLQUFmLENBQXFCLElBQUlMLE1BQUosQ0FBVyxLQUFLRCxTQUFMLEVBQVgsQ0FBckIsQ0FBUDtBQUNBOztBQUVKOzs7Ozs7OzJCQUlTTyxRLEVBQVU7QUFDbEIsT0FBSUMsU0FBUyxJQUFJUCxNQUFKLENBQVcsS0FBS0QsU0FBTCxFQUFYLENBQWI7QUFDQVMsTUFBR0MsU0FBSCxDQUFhSCxXQUFXLE1BQXhCLEVBQWdDQyxNQUFoQyxFQUF3QyxVQUFVRyxHQUFWLEVBQWU7QUFDdEQsUUFBR0EsR0FBSCxFQUFRLE9BQU9DLFFBQVFDLEdBQVIsQ0FBWUYsR0FBWixDQUFQO0FBQ1IsSUFGRDtBQUdBOzs7Ozs7UUFHTTFDLE0sR0FBQUEsTSIsImZpbGUiOiJ3cml0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE9iamVjdCB0aGF0IHB1dHMgdG9nZXRoZXIgdHJhY2tzIGFuZCBwcm92aWRlcyBtZXRob2RzIGZvciBmaWxlIG91dHB1dC5cbiAqIEBwYXJhbSB7YXJyYXl9IHRyYWNrcyAtIEFuIGFycmF5IG9mIHtUcmFja30gb2JqZWN0cy5cbiAqIEByZXR1cm4ge1dyaXRlcn1cbiAqL1xuY2xhc3MgV3JpdGVyIHtcblx0Y29uc3RydWN0b3IodHJhY2tzKSB7XG5cdFx0dGhpcy5kYXRhID0gW107XG5cblx0XHR2YXIgdHJhY2tUeXBlID0gdHJhY2tzLmxlbmd0aCA+IDEgPyBDb25zdGFudHMuSEVBREVSX0NIVU5LX0ZPUk1BVDEgOiBDb25zdGFudHMuSEVBREVSX0NIVU5LX0ZPUk1BVDA7XG5cdFx0dmFyIG51bWJlck9mVHJhY2tzID0gVXRpbHMubnVtYmVyVG9CeXRlcyh0cmFja3MubGVuZ3RoLCAyKTsgLy8gdHdvIGJ5dGVzIGxvbmdcblxuXHRcdC8vIEhlYWRlciBjaHVua1xuXHRcdHRoaXMuZGF0YS5wdXNoKG5ldyBDaHVuayh7XG5cdFx0XHRcdFx0XHRcdFx0dHlwZTogQ29uc3RhbnRzLkhFQURFUl9DSFVOS19UWVBFLFxuXHRcdFx0XHRcdFx0XHRcdGRhdGE6IHRyYWNrVHlwZS5jb25jYXQobnVtYmVyT2ZUcmFja3MsIENvbnN0YW50cy5IRUFERVJfQ0hVTktfRElWSVNJT04pfSkpO1xuXG5cdFx0Ly8gVHJhY2sgY2h1bmtzXG5cdFx0dHJhY2tzLmZvckVhY2goZnVuY3Rpb24odHJhY2ssIGkpIHtcblx0XHRcdHRyYWNrLmFkZEV2ZW50KG5ldyBNZXRhRXZlbnQoe2RhdGE6IENvbnN0YW50cy5NRVRBX0VORF9PRl9UUkFDS19JRH0pKTtcblx0XHRcdHRoaXMuZGF0YS5wdXNoKHRyYWNrKTtcblx0XHR9LCB0aGlzKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBCdWlsZHMgdGhlIGZpbGUgaW50byBhIFVpbnQ4QXJyYXlcblx0ICogQHJldHVybiB7VWludDhBcnJheX1cblx0ICovXG5cdGJ1aWxkRmlsZSgpIHtcblx0XHR2YXIgYnVpbGQgPSBbXTtcblxuXHRcdC8vIERhdGEgY29uc2lzdHMgb2YgY2h1bmtzIHdoaWNoIGNvbnNpc3RzIG9mIGRhdGFcblx0XHR0aGlzLmRhdGEuZm9yRWFjaCgoZCkgPT4gYnVpbGQgPSBidWlsZC5jb25jYXQoZC50eXBlLCBkLnNpemUsIGQuZGF0YSkpO1xuXG5cdFx0cmV0dXJuIG5ldyBVaW50OEFycmF5KGJ1aWxkKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDb252ZXJ0IGZpbGUgYnVmZmVyIHRvIGEgYmFzZTY0IHN0cmluZy4gIERpZmZlcmVudCBtZXRob2RzIGRlcGVuZGluZyBvbiBpZiBicm93c2VyIG9yIG5vZGUuXG5cdCAqIEByZXR1cm4ge3N0cmluZ31cblx0ICovXG5cdGJhc2U2NCgpIHtcblx0XHRpZiAodHlwZW9mIGJ0b2EgPT09ICdmdW5jdGlvbicpIHJldHVybiBidG9hKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgdGhpcy5idWlsZEZpbGUoKSkpO1xuXHRcdHJldHVybiBuZXcgQnVmZmVyKHRoaXMuYnVpbGRGaWxlKCkpLnRvU3RyaW5nKCdiYXNlNjQnKTtcblx0fVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBkYXRhIFVSSS5cbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgZGF0YVVyaSgpIHtcbiAgICBcdHJldHVybiAnZGF0YTphdWRpby9taWRpO2Jhc2U2NCwnICsgdGhpcy5iYXNlNjQoKTtcbiAgICB9XG5cblx0LyoqXG5cdCAqIE91dHB1dCB0byBzdGRvdXRcblx0ICogQHJldHVybiB7c3RyaW5nfVxuXHQgKi9cbiAgICBzdGRvdXQoKSB7XG4gICAgXHRyZXR1cm4gcHJvY2Vzcy5zdGRvdXQud3JpdGUobmV3IEJ1ZmZlcih0aGlzLmJ1aWxkRmlsZSgpKSk7XG4gICAgfVxuXG5cdC8qKlxuXHQgKiBTYXZlIHRvIE1JREkgZmlsZVxuXHQgKiBAcGFyYW0ge3N0cmluZ30gZmlsZW5hbWVcblx0ICovXG5cdHNhdmVNSURJKGZpbGVuYW1lKSB7XG5cdFx0dmFyIGJ1ZmZlciA9IG5ldyBCdWZmZXIodGhpcy5idWlsZEZpbGUoKSk7XG5cdFx0ZnMud3JpdGVGaWxlKGZpbGVuYW1lICsgJy5taWQnLCBidWZmZXIsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdGlmKGVycikgcmV0dXJuIGNvbnNvbGUubG9nKGVycik7XG5cdFx0fSk7XG5cdH1cbn1cblxuZXhwb3J0IHtXcml0ZXJ9O1xuIl19
